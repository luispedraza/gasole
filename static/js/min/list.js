eval(function(a,b,c,d,e,f){e=function(a){return(a<b?"":e(parseInt(a/b)))+(35<(a%=b)?String.fromCharCode(a+29):a.toString(36))};if(!"".replace(/^/,String)){for(;c--;)f[e(c)]=d[c]||e(c);d=[function(a){return f[a]}];e=function(){return"\\w+"};c=1}for(;c--;)d[c]&&(a=a.replace(RegExp("\\b"+e(c)+"\\b","g"),d[c]));return a}('5 J(b,a){b.17().V(J,n.o.32);4.F=b;4.2F=b.17().2r();4.P=a;4.B=s;4.q=s;4.X=s;4.1j=t;4.L(b.u())}J.6.2E=5(){7 d=4;7 g;7 f;4.q=3C.3x("2a");4.q.5m=4.2F;9(4.1j){4.27()}4.4I().4F.4A(4.q);n.o.z.1L(4.u(),"4i",5(){f=g});n.o.z.1E(4.q,"44",5(){g=K;f=t});n.o.z.1E(4.q,"2N",5(e){g=t;9(!f){7 c;7 b;7 a=d.F.17();n.o.z.W(a,"2N",d.F);n.o.z.W(a,"40",d.F);9(a.2C()){b=a.1w();c=d.F.1y();a.u().1V(c);1O(5(){a.u().1V(c);9(b!==s&&(a.u().1a()>b)){a.u().3O(b+1)}},3F)}e.3B=K;9(e.2n){e.2n()}}});n.o.z.1E(4.q,"2f",5(){7 a=d.F.17();n.o.z.W(a,"2f",d.F)});n.o.z.1E(4.q,"2B",5(){7 a=d.F.17();n.o.z.W(a,"2B",d.F)})};J.6.2G=5(){9(4.q&&4.q.2T){4.1N();n.o.z.5d(4.q);4.q.2T.55(4.q);4.q=s}};J.6.3f=5(){9(4.1j){7 a=4.28(4.B);4.q.13.1F=a.y+"A";4.q.13.1M=a.x+"A"}};J.6.1N=5(){9(4.q){4.q.13.38="2W"}4.1j=t};J.6.27=5(){9(4.q){7 a=4.28(4.B);4.q.13.4r=4.2V(a);9(4.F.12){4.q.2S="<4d 4a=\'"+4.2c+"\'><2a 13=\'21: 2Q; 1F: 2P; 1M: 2P; 1c: "+4.Z+"A;\'>"+4.X.1d+"</2a>"}E{4.q.2S=4.X.1d}9(1p 4.X.15==="1f"||4.X.15===""){4.q.15=4.F.17().2K()}E{4.q.15=4.X.15}4.q.13.38=""}4.1j=K};J.6.2I=5(a){4.X=a;7 b=v.3Y(0,a.2D-1);b=v.1X(4.P.p-1,b);7 c=4.P[b];4.2c=c.1W;4.Q=c.14;4.Z=c.1c;4.G=c.3T;4.1P=c.3Q||[1Q(4.Q/2,10),1Q(4.Z/2,10)];4.2l=c.3H||"3E";4.2i=c.3A||11;4.2h=c.3z||"2W";4.2g=c.3w||"3u";4.2A=c.3r||"3o";4.2U=c.3l||"5l,5h-5c";4.3j=c.54||"0 0"};J.6.3g=5(a){4.B=a};J.6.2V=5(b){7 a=[];9(!4.F.12){a.H(\'3e-4S:1W(\'+4.2c+\');\');a.H(\'3e-21:\'+4.3j+\';\')}9(1p 4.G===\'4P\'){9(1p 4.G[0]===\'3b\'&&4.G[0]>0&&4.G[0]<4.Q){a.H(\'14:\'+(4.Q-4.G[0])+\'A; 3a-1F:\'+4.G[0]+\'A;\')}E{a.H(\'14:\'+4.Q+\'A; 37-14:\'+4.Q+\'A;\')}9(1p 4.G[1]===\'3b\'&&4.G[1]>0&&4.G[1]<4.Z){a.H(\'1c:\'+(4.Z-4.G[1])+\'A; 3a-1M:\'+4.G[1]+\'A;\')}E{a.H(\'1c:\'+4.Z+\'A; 1d-35:1e;\')}}E{a.H(\'14:\'+4.Q+\'A; 37-14:\'+4.Q+\'A; 1c:\'+4.Z+\'A; 1d-35:1e;\')}a.H(\'4G:4E; 1F:\'+b.y+\'A; 1M:\'+b.x+\'A; 4C:\'+4.2l+\'; 21:2Q; 1I-1r:\'+4.2i+\'A; 1I-4z:\'+4.2U+\'; 1I-4y:\'+4.2g+\'; 1I-13:\'+4.2A+\'; 1d-4x:\'+4.2h+\';\');j a.4v("")};J.6.28=5(b){7 a=4.3d().22(b);a.x-=4.1P[1];a.y-=4.1P[0];j a};5 D(a){4.16=a;4.O=a.u();4.T=a.3h();4.Y=a.2R();4.1g=a.3k();4.12=a.3i();4.k=[];4.B=s;4.2b=s;4.18=I J(4,a.20())}D.6.41=5(){j 4.k.p};D.6.1D=5(){j 4.k};D.6.2O=5(){j 4.B};D.6.u=5(){j 4.O};D.6.17=5(){j 4.16};D.6.1y=5(){7 i;7 b=I n.o.1q(4.B,4.B);7 a=4.1D();w(i=0;i<a.p;i++){b.V(a[i].S())}j b};D.6.1C=5(){4.18.L(s);4.k=[];1Z 4.k};D.6.1B=5(e){7 i;7 c;7 b;9(4.2M(e)){j t}9(!4.B){4.B=e.S();4.1Y()}E{9(4.1g){7 l=4.k.p+1;7 a=(4.B.U()*(l-1)+e.S().U())/l;7 d=(4.B.19()*(l-1)+e.S().19())/l;4.B=I n.o.1o(a,d);4.1Y()}}e.1n=K;4.k.H(e);c=4.k.p;b=4.16.1w();9(b!==s&&4.O.1a()>b){9(e.u()!==4.O){e.L(4.O)}}E 9(c<4.Y){9(e.u()!==4.O){e.L(4.O)}}E 9(c===4.Y){w(i=0;i<c;i++){4.k[i].L(s)}}E{e.L(s)}4.2L();j K};D.6.2J=5(a){j 4.2b.34(a.S())};D.6.1Y=5(){7 a=I n.o.1q(4.B,4.B);4.2b=4.16.2e(a)};D.6.2L=5(){7 c=4.k.p;7 a=4.16.1w();9(a!==s&&4.O.1a()>a){4.18.1N();j}9(c<4.Y){4.18.1N();j}7 b=4.16.20().p;7 d=4.16.36()(4.k,b);4.18.3g(4.B);4.18.2I(d);4.18.27()};D.6.2M=5(a){7 i;9(4.k.1m){j 4.k.1m(a)!==-1}E{w(i=0;i<4.k.p;i++){9(a===4.k[i]){j K}}}j t};5 8(a,c,b){4.V(8,n.o.32);c=c||[];b=b||{};4.k=[];4.C=[];4.1s=[];4.1k=s;4.1t=t;4.T=b.3X||3W;4.Y=b.3V||2;4.1R=b.2z||s;4.P=b.3U||[];4.29=b.15||"";4.1K=K;9(b.2y!==1f){4.1K=b.2y}4.1g=t;9(b.2x!==1f){4.1g=b.2x}4.1b=t;9(b.2v!==1f){4.1b=b.2v}4.12=t;9(b.2u!==1f){4.12=b.2u}4.1A=b.3S||8.2s;4.1v=b.3R||8.2p;4.1u=b.3P||8.2o;4.1U=b.3J||8.2m;4.1S=b.3I||8.2k;4.1z=b.3G||8.2j;4.1T=b.3D||"N";9(3K.3L.3M().1m("3N")!==-1){4.1S=4.1z}4.2H();4.2w(c,K);4.L(a)}8.6.2E=5(){7 a=4;4.1k=4.u();4.1t=K;4.1h();4.1s=[n.o.z.1L(4.u(),"3y",5(){a.1x(t);9(4.1a()===(4.2q("3v")||0)||4.1a()===4.2q("2z")){n.o.z.W(4,"2t")}}),n.o.z.1L(4.u(),"2t",5(){a.1l()})]};8.6.2G=5(){7 i;w(i=0;i<4.k.p;i++){9(4.k[i].u()!==4.1k){4.k[i].L(4.1k)}}w(i=0;i<4.C.p;i++){4.C[i].1C()}4.C=[];w(i=0;i<4.1s.p;i++){n.o.z.3t(4.1s[i])}4.1s=[];4.1k=s;4.1t=t};8.6.3f=5(){};8.6.2H=5(){7 i,1r;9(4.P.p>0){j}w(i=0;i<4.1u.p;i++){1r=4.1u[i];4.P.H({1W:4.1A+(i+1)+"."+4.1v,14:1r,1c:1r})}};8.6.3s=5(){7 i;7 a=4.1D();7 b=I n.o.1q();w(i=0;i<a.p;i++){b.V(a[i].S())}4.u().1V(b)};8.6.3h=5(){j 4.T};8.6.3Z=5(a){4.T=a};8.6.2R=5(){j 4.Y};8.6.3q=5(a){4.Y=a};8.6.1w=5(){j 4.1R};8.6.3p=5(a){4.1R=a};8.6.20=5(){j 4.P};8.6.42=5(a){4.P=a};8.6.2K=5(){j 4.29};8.6.43=5(a){4.29=a};8.6.2C=5(){j 4.1K};8.6.3n=5(a){4.1K=a};8.6.3k=5(){j 4.1g};8.6.3m=5(a){4.1g=a};8.6.46=5(){j 4.1b};8.6.47=5(a){4.1b=a};8.6.5k=5(){j 4.1v};8.6.5i=5(a){4.1v=a};8.6.5g=5(){j 4.1A};8.6.5f=5(a){4.1A=a};8.6.5b=5(){j 4.1u};8.6.5a=5(a){4.1u=a};8.6.36=5(){j 4.1U};8.6.59=5(a){4.1U=a};8.6.3i=5(){j 4.12};8.6.57=5(a){4.12=a};8.6.51=5(){j 4.1z};8.6.50=5(a){4.1z=a};8.6.2r=5(){j 4.1T};8.6.4Z=5(a){4.1T=a};8.6.1D=5(){j 4.k};8.6.4X=5(){j 4.k.p};8.6.4V=5(){j 4.C};8.6.4U=5(){j 4.C.p};8.6.1B=5(b,a){4.2d(b);9(!a){4.1l()}};8.6.2w=5(b,a){7 i;w(i=0;i<b.p;i++){4.2d(b[i])}9(!a){4.1l()}};8.6.2d=5(b){9(b.4T()){7 a=4;n.o.z.1L(b,"4R",5(){9(a.1t){4.1n=t;a.1h()}})}b.1n=t;4.k.H(b)};8.6.4Q=5(c,a){7 b=4.26(c);9(!a&&b){4.1h()}j b};8.6.4O=5(a,c){7 i,r;7 b=t;w(i=0;i<a.p;i++){r=4.26(a[i]);b=b||r}9(!c&&b){4.1h()}j b};8.6.26=5(b){7 i;7 a=-1;9(4.k.1m){a=4.k.1m(b)}E{w(i=0;i<4.k.p;i++){9(b===4.k[i]){a=i;4N}}}9(a===-1){j t}b.L(s);4.k.4K(a,1);j K};8.6.4J=5(){4.1x(K);4.k=[]};8.6.1h=5(){7 a=4.C.4H();4.C=[];4.1x(t);4.1l();1O(5(){7 i;w(i=0;i<a.p;i++){a[i].1C()}},0)};8.6.2e=5(d){7 f=4.3d();7 c=I n.o.1o(d.23().U(),d.23().19());7 a=I n.o.1o(d.24().U(),d.24().19());7 e=f.22(c);e.x+=4.T;e.y-=4.T;7 g=f.22(a);g.x-=4.T;g.y+=4.T;7 b=f.2X(e);7 h=f.2X(g);d.V(b);d.V(h);j d};8.6.1l=5(){4.25(0)};8.6.1x=5(a){7 i,M;w(i=0;i<4.C.p;i++){4.C[i].1C()}4.C=[];w(i=0;i<4.k.p;i++){M=4.k[i];M.1n=t;9(a){M.L(s)}}};8.6.33=5(b,e){7 R=4D;7 g=(e.U()-b.U())*v.1H/1G;7 f=(e.19()-b.19())*v.1H/1G;7 a=v.1J(g/2)*v.1J(g/2)+v.31(b.U()*v.1H/1G)*v.31(e.U()*v.1H/1G)*v.1J(f/2)*v.1J(f/2);7 c=2*v.4B(v.30(a),v.30(1-a));7 d=R*c;j d};8.6.2Z=5(b,a){j a.34(b.S())};8.6.39=5(c){7 i,d,N,1e;7 a=4L;7 b=s;w(i=0;i<4.C.p;i++){N=4.C[i];1e=N.2O();9(1e){d=4.33(1e,c.S());9(d<a){a=d;b=N}}}9(b&&b.2J(c)){b.1B(c)}E{N=I D(4);N.1B(c);4.C.H(N)}};8.6.25=5(e){7 i,M;7 d;7 c=4;9(!4.1t){j}9(e===0){n.o.z.W(4,"4M",4);9(1p 4.1i!=="1f"){4w(4.1i);1Z 4.1i}}9(4.u().1a()>3){d=I n.o.1q(4.u().1y().24(),4.u().1y().23())}E{d=I n.o.1q(I n.o.1o(3c.4u,-2Y.4t),I n.o.1o(-3c.4s,2Y.4q))}7 a=4.2e(d);7 b=v.1X(e+4.1S,4.k.p);w(i=e;i<b;i++){M=4.k[i];9(!M.1n&&4.2Z(M,a)){9(!4.1b||(4.1b&&M.4W())){4.39(M)}}}9(b<4.k.p){4.1i=1O(5(){c.25(b)},0)}E{1Z 4.1i;n.o.z.W(4,"4p",4)}};8.6.V=5(d,c){j(5(b){7 a;w(a 4Y b.6){4.6[a]=b.6[a]}j 4}).4o(d,[c])};8.2m=5(a,c){7 f=0;7 b="";7 d=a.p.4n();7 e=d;4m(e!==0){e=1Q(e/10,10);f++}f=v.1X(f,c);j{1d:d,2D:f,15:b}};8.2k=52;8.2j=4l;8.2s="4k://n-o-4j-58-4h.4g.4f/4e/4c/5e/4b/m";8.2p="49";8.2o=[53,56,5j,48,45];',
62,333,"    this function prototype var MarkerClusterer if          return markers_   google maps length div_  null false getMap Math for   event px center_ clusters_ Cluster else cluster_ anchor_ push new ClusterIcon true setMap marker cluster map_ styles_ height_  getPosition gridSize_ lat extend trigger sums_ minClusterSize_ width_   printable_ style height title markerClusterer_ getMarkerClusterer clusterIcon_ lng getZoom ignoreHidden_ width text center undefined averageCenter_ repaint timerRefStatic visible_ activeMap_ redraw_ indexOf isAdded LatLng typeof LatLngBounds size listeners_ ready_ imageSizes_ imageExtension_ getMaxZoom resetViewport_ getBounds batchSizeIE_ imagePath_ addMarker remove getMarkers addDomListener top 180 PI font sin zoomOnClick_ addListener left hide setTimeout anchorIcon_ parseInt maxZoom_ batchSize_ clusterClass_ calculator_ fitBounds url min calculateBounds_ delete getStyles position fromLatLngToDivPixel getNorthEast getSouthWest createClusters_ removeMarker_ show getPosFromLatLng_ title_ div bounds_ url_ pushMarkerTo_ getExtendedBounds mouseover fontWeight_ textDecoration_ textSize_ BATCH_SIZE_IE BATCH_SIZE textColor_ CALCULATOR stopPropagation IMAGE_SIZES IMAGE_EXTENSION get getClusterClass IMAGE_PATH idle printable ignoreHidden addMarkers averageCenter zoomOnClick maxZoom fontStyle_ mouseout getZoomOnClick index onAdd className_ onRemove setupStyles_ useStyle isMarkerInClusterBounds getTitle updateIcon_ isMarkerAlreadyAdded_ click getCenter 0px absolute getMinimumClusterSize innerHTML parentNode fontFamily_ createCss none fromDivPixelToLatLng 178 isMarkerInBounds_ sqrt cos OverlayView distanceBetweenPoints_ contains align getCalculator line display addToClosestCluster_ padding number 85 getProjection background draw setCenter getGridSize getPrintable backgroundPosition_ getAverageCenter fontFamily setAverageCenter setZoomOnClick normal setMaxZoom setMinimumClusterSize fontStyle fitMapToMarkers removeListener bold minZoom fontWeight createElement zoom_changed textDecoration textSize cancelBubble document clusterClass black 100 batchSizeIE textColor batchSize calculator navigator userAgent toLowerCase msie setZoom imageSizes anchorIcon imageExtension imagePath anchor styles minimumClusterSize 60 gridSize max setGridSize clusterclick getSize setStyles setTitle mousedown 90 getIgnoreHidden setIgnoreHidden 78 png src images trunk img svn com googlecode v3 bounds_changed utility http 500 while toString apply clusteringend 00048865625 cssText 08136444384544 48388434375 02070771743472 join clearTimeout decoration weight family appendChild atan2 color 6371 pointer overlayMouseTarget cursor slice getPanes clearMarkers splice 40000 clusteringbegin break removeMarkers object removeMarker dragend image getDraggable getTotalClusters getClusters getVisible getTotalMarkers in setClusterClass setBatchSizeIE getBatchSizeIE 2000  backgroundPosition removeChild  setPrintable library setCalculator setImageSizes getImageSizes serif clearInstanceListeners markerclustererplus setImagePath getImagePath sans setImageExtension 66 getImageExtension Arial className".split(" "),
0,{}));var FUEL_OPTIONS={1:{"short":"G95",name:"Gasolina 95"},3:{"short":"G98",name:"Gasolina 98"},4:{"short":"GOA",name:"Gas\u00f3leo Automoci\u00f3n"},5:{"short":"NGO",name:"Nuevo Gas\u00f3leo A"},6:{"short":"GOB",name:"Gas\u00f3leo B"},7:{"short":"GOC",name:"Gas\u00f3leo C"},8:{"short":"BIOD",name:"Biodi\u00e9sel"}},FUEL_COLORS={G95:"#006633",G98:"#339933",GOA:"#000",NGO:"#aaa",GOB:"#CC3333",GOC:"#FF3300",BIOD:"#FFCC33"},PROVS={"\u00c1lava":"01",Albacete:"02",Alicante:"03","Almer\u00eda":"04",Asturias:"33",
"\u00c1vila":"05",Badajoz:"06","Balears (Illes)":"07",Barcelona:"08",Burgos:"09","C\u00e1ceres":"10","C\u00e1diz":"11",Cantabria:"39","Castell\u00f3n / Castell\u00f3":"12",Ceuta:"51","Ciudad Real":"13","C\u00f3rdoba":"14","Coru\u00f1a (A)":"15",Cuenca:"16",Girona:"17",Granada:"18",Guadalajara:"19","Guip\u00fazcoa":"20",Huelva:"21",Huesca:"22","Ja\u00e9n":"23","Le\u00f3n":"24",Lleida:"25",Lugo:"27",Madrid:"28","M\u00e1laga":"29",Melilla:"52",Murcia:"30",Navarra:"31",Ourense:"32",Palencia:"34","Palmas (Las)":"35",
Pontevedra:"36","Rioja (La)":"26",Salamanca:"37","Santa Cruz De Tenerife":"38",Segovia:"40",Sevilla:"41",Soria:"42",Tarragona:"43",Teruel:"44",Toledo:"45","Valencia / Val\u00e8ncia":"46",Valladolid:"47",Vizcaya:"48",Zamora:"49",Zaragoza:"50"};function getProvName(a){for(k in PROVS)if(PROVS[k]==a)return k}
function toTitle(a){return a.replace(" [N]","").replace(/^CARRETERA ?|^CR\.? ?/i,"CTRA. ").replace(/(CTRA. )+/i,"CTRA. ").replace(/^AVENIDA ?|^AV. ?/i,"AVDA. ").replace(/^POLIGONO INDUSTRIAL ?|POLIGONO ?|P\.I\. ?/i,"POL. IND. ").replace(/^CALLE |^CL\.? ?|C\/ ?/i,"C/ ").replace(/^RONDA |^RD /i,"RDA. ").replace(/^AUTOPISTA (AUTOPISTA ?)?/i,"AU. ").replace(/^PLAZA ?/i,"PL. ").replace(/^PASEO (PASEO ?)?/i,"P\u00ba ").replace(/^TRAVESS?[I\u00cd]A /i,"TRAV. ").replace(/^V[i\u00ed]A (V[I\u00cd]A )?/i,"V\u00cdA ").replace(/\B[^\d- ]+[ $]/g,
function(a){return a.toLowerCase()}).replace(/\b[NAE]-.+\b/,function(a){return a.toUpperCase()}).replace(/\[D\]$/,"(m.d.)").replace(/\[I\]$/,"(m.i.)").replace(/ \[N\]$/,"")}
function getLogo(a){return a&&(a=a.replace(/camspa/i,"campsa"),logo=a.match(/\b(abycer|agla|alcampo|andamur|a\.?n\.? energeticos|avia|bonarea|b\.?p\.?|buquerin|campsa|carmoned|carrefour|cepsa|empresoil|eroski|esclatoil|galp|gasolben|iberdoex|leclerc|makro|meroil|norpetrol|petrem|petrocat|petromiralles|petronor|repostar|repsol|saras|shell|simply|staroil|tamoil|valcarce)\b/i))?logo[0].replace(/\./g,"").replace(/ /g,"_").toLowerCase():null}
function decodeName(a){return decodeURI(a).replace(/_/g," ").replace(/\|/g,"/")}function prettyName(a){a.match("/")&&(a=a.split("/")[1]);a.match(/\)$/)&&(a=a.match(/\(.+\)$/g)[0].replace("(","").replace(")"," ")+a.split(" (")[0]);return a}function decodeArray(a){for(var b=0;b<a.length;b++)a[b]=decodeName(a[b]);return a}function encodeName(a){return a.replace(/\//g,"|").replace(/ /g,"_")}function checkLocalStorage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}
var info=null,LOCAL_EXPIRATION=36E5,APIS={gasolineras:"api",resultados:"geo",ficha:"api"};function getApiData(a,b,c){var d=new XMLHttpRequest;d.onload=function(a){info=JSON.parse(a.target.responseText);console.log("datos obtenidos: ",info);b&&(localStorage.setItem(b,JSON.stringify(info)),localStorage.setItem("timestamp",(new Date).getTime()));c(info)};d.open("GET",a);d.send()}
function clearCurrentStorage(){if(checkLocalStorage()){var a=window.location.pathname.split("/");"ficha"==a[1]&&localStorage.removeItem(a.slice(2).join("*"))}}
function getData(a){var b=window.location.pathname.split("/"),c=b[1],d=b[2],e=b[3],f=null;if(checkLocalStorage()){var g=localStorage.timestamp;g&&(new Date).getTime()-parseInt(g)>LOCAL_EXPIRATION&&(console.log("datos antiguos"),localStorage.clear());g=null;"resultados"==c?(f=d,g=localStorage[f]):"gasolineras"==c?e?(f=[d,e].join("*"),(g=localStorage[f])||(g=localStorage[d])):(f=d,g=localStorage[f]):"ficha"==c&&(f=[d,e,b[4]].join("*"),g=localStorage[f]);g&&(info=JSON.parse(g))}info?("gasolineras"==
c&&e&&(b=decodeName(d),e=decodeName(e),tempData={_data:{}},tempData._data[b]={},tempData._data[b][e]=info._data[b][e],info=tempData),console.log("datos recuperados: ",info),a(info)):(console.log(f),getApiData(document.URL.replace(c,APIS[c]),f,a));return null};var data,map,place="",markers=[],province="",town="",markerCenter=null,markerDetail=null,pagerN=15,pagerCurrent=null,infoWindow=null,cluster=null,bounds=new google.maps.LatLngBounds,TO_DAYS=864E5;
function stats(){this.types={};this.n=0;this.init=!1;this.add=function(a){if(!this.init){for(var b in a){var c=a[b];if(this.types.hasOwnProperty(b)){var d=this.types[b];c>d.max?d.max=c:c<d.min&&(d.min=c);d.mean=(d.mean*d.n+c)/(d.n+1);d.n++}else this.types[b]={max:c,min:c,mean:c,n:1}}this.n++}};this.run=function(){var a=0,b;for(b in this.types)a+=this.types[b].n,this.types[b].range=this.types[b].max-this.types[b].min;for(b in this.types)this.types[b].w=this.types[b].n/a;this.init=!0}}
var Stats=new stats,COLORS={min:"#36AE34",minStroke:"#fff",max:"#f00",maxStroke:"#fff",mu:"#3399CC",muStroke:"#fff"};
function newReference(a){infoWindow&&infoWindow.close();var b=a;b||(b=document.getElementById("from").value);(new google.maps.Geocoder).geocode({address:b},function(b,d){var e=document.getElementById("distance-info");if(d==google.maps.GeocoderStatus.OK){markerCenter?markerCenter.setPosition(b[0].geometry.location):(markerCenter=new google.maps.Marker({map:map,position:b[0].geometry.location,draggable:!0}),google.maps.event.addListener(markerCenter,"click",function(a){infoWindow&&infoWindow.close();
infoWindow=new google.maps.InfoWindow({content:"Punto de referencia:<br /> "+this.place.bold()});infoWindow.open(map,this)}));markerCenter.set("place",b[0].formatted_address);map.panTo(b[0].geometry.location);a||map.setZoom(14);calcDistances();var f=document.getElementById("table-data").getElementsByTagName("tr")[0];e.innerHTML=f?"La gasolinera m\u00e1s pr\u00f3xima a "+b[0].formatted_address+" se encuentra en "+f.getElementsByClassName("T_ADDR")[0].textContent:"No se ha encontrado ninguna gasolinera. Intenta ampliar el radio de busqueda"}else e.innerHTML=
"No se ha podido localizar la referencia."})}
function paginateTable(a){var b=document.getElementById("table-data").getElementsByClassName("r_on"),c=document.getElementById("pager-links");if(b.length){if("more"===a?a=Math.min(pagerCurrent+pagerN,parseInt(b.length/pagerN)*pagerN):"less"===a&&(a=Math.max(pagerCurrent-pagerN,0)),!(a>=b.length)){c.innerHTML="";for(var d=0;d<b.length;d++){b[d].className=b[d].className.replace(" p_off","");if(d<a||d>=a+pagerN)b[d].className+=" p_off";if(0==d%pagerN){var e=document.createElement("div");e.innerHTML=
d+1+"<br/>"+Math.min(d+pagerN,b.length);e.setAttribute("onclick","javascript:paginateTable("+d+");");d==a?e.className="p current":e.className="p";c.appendChild(e)}}pagerCurrent=a}}else c.innerHTML="<p>No hay resultados coincidentes con los criterios de b\u00fasqueda.<br>Comprueba el filtro y tipos de combustible seleccionados.</p>"}
function calcDistances(){for(var a=document.getElementById("table-data").getElementsByClassName("T_DIST"),b=0;b<a.length;b++){var c=a[b].getAttribute("data-geo");if(c){var c=c.split(","),d=111.03461*(c[0]-markerCenter.position.lat()),c=85.39383*(c[1]-markerCenter.position.lng()),d=Math.sqrt(d*d+c*c).toFixed(1);a[b].getElementsByTagName("span")[0].textContent=d}}sortTable("T_DIST",!1,!0)}
function mapCluster(){if(document.getElementById("cluster").checked)for(var a=0;a<markers.length;a++)markers[a].getMap()&&cluster.addMarker(markers[a]);else cluster.clearMarkers(),updateMarkers()}function markerColor(a,b){for(var c=0,d=0,e=0;e<a.length;e++){var f=a[e],g=b[f];(f=Stats.types[f])&&g&&(c=f.range?(c*d+(g-f.min)/f.range)/++d:c*d+0.5/++d)}return 0==d?null:0.33>c?[COLORS.minStroke,COLORS.min]:0.66>c?[COLORS.muStroke,COLORS.mu]:[COLORS.maxStroke,COLORS.max]}
function updateMarkers(){var a=document.getElementById("table-data").getElementsByTagName("tr");selection=getSelTypes();for(var b=0;b<a.length;b++){var c=markers[a[b].id.split("-")[1]];if(c){if(a[b].className.match("r_on")){var d=markerColor(selection,c.get("price"));if(d){c.setMap(map);c.icon.strokeColor=d[0];c.icon.fillColor=d[1];continue}}c.setMap(null)}}}
function initMap(){var a={mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("google_map"),a);cluster=new MarkerClusterer(map,null,{imagePath:"/",styles:[{height:40,width:40,url:"/img/cluster.png",backgroundPosition:"-2px -2px"},{height:50,width:50,url:"/img/cluster.png",backgroundPosition:"-44px -2px"},{height:60,width:60,url:"/img/cluster.png",backgroundPosition:"-2px -54px"},{height:70,width:70,url:"/img/cluster.png",backgroundPosition:"-2px -116px"}]});window.location.hostname.match("localhost")||
(a=document.createElement("div"),adUnit=new google.maps.adsense.AdUnit(a,{format:google.maps.adsense.AdFormat.VERTICAL_BANNER,position:google.maps.ControlPosition.RIGHT_TOP,backgroundColor:"#c4d4f3",borderColor:"#e5ecf9",titleColor:"#0000cc",textColor:"#000000",urlColor:"#009900",map:map,visible:!0,publisherId:"pub-9285487390483271"}))}
function sortTable(a,b,c){function d(a){if(1>=a.length)return a;for(var b=Math.floor(Math.random()*a.length),c=b+1;c<a.length&&a[c][0]==a[b][0];c++);for(var b=a.splice(c-1,1),c=[],f=[],e=0;e<a.length;e++)a[e][0]<=b[0][0]?c.push(a[e]):f.push(a[e]);return d(c).concat(b,d(f))}"undefined"==typeof b&&(b=!1);for(var e=document.getElementById("table-data"),f=e.getElementsByClassName(a),g=[],h=0;h<f.length;h++)if(f[h].textContent){var p=c?parseFloat(f[h].textContent):f[h].textContent;g.push([p,h])}g=d(g);
b&&g.reverse();f=e.getElementsByTagName("tr");c=[];for(h=0;h<f.length;h++)c.push(f[h]);for(f=0;f<g.length;f++)e.insertBefore(c[g[f][1]],e.children[f]);e=document.getElementById("table").getElementsByTagName("th");for(g=0;g<e.length;g++)e[g].className=e[g].className.replace(" sort_up","").replace(" sort_down",""),e[g].className.match(a)&&(e[g].className+=b?" sort_down":" sort_up");paginateTable(0)}
function filterTypes(a){for(var b=0;b<a.length;b++)for(var c=a[b].split(" "),d=c[0],e=d+" off",f=d+" on",g=d,d=document.getElementById("table").getElementsByClassName(d),h=0;h<d.length;h++){var p=d[h];"off"==c[1]?p.className=e:d[h].className=p.textContent?f:g}a=document.getElementById("table-data").getElementsByTagName("tr");for(b=0;b<a.length;b++)a[b].className=a[b].getElementsByClassName("on").length?"r_on":"r_off"}
function filterText(){function a(a){return a.toLowerCase().replace(/[\u00e1\u00e0\u00e4]/g,"a").replace(/[\u00e9\u00e8\u00eb]/g,"e").replace(/[\u00ed\u00ec\u00ef]/g,"i").replace(/[\u00f3\u00f2\u00f6]/g,"o").replace(/[\u00fa\u00f9\u00fc]/g,"u")}var b=document.getElementById("contains").value;if(b.length)for(var b=b.split(/ +/),c=document.getElementById("table-data").getElementsByTagName("tr"),d=0;d<c.length;d++){var e=c[d];if("r_off"!=e.className)for(var f=0;f<b.length;f++)if(b[f].length){for(var g=
!1,h=RegExp(a(b[f])),p=e.getElementsByTagName("td"),q=0;2>q;q++)g=g||null!=h.exec(a(p[q].textContent));e.className=g?"r_on":"f_off";if(!g)break}}else{c=document.getElementById("table-data").getElementsByClassName("f_off");for(d=0;d<c.length;d++)c[d].className="r_on"}}
function initControl(){for(var a=document.getElementById("fuel-type").getElementsByTagName("li"),b=[],c=0;c<a.length;c++)Stats.types[a[c].className.split(" ")[0].split("_")[1]]?(b.push(a[c].className),a[c].addEventListener("click",function(){var a=this.className.split(" ");this.className=a=a[0]+" "+("on"==a[1]?"off":"on");filterTypes([a]);filterText();paginateTable(0);updateMarkers()})):(b.push(a[c].className.replace("on","off")),a[c].className="disabled");filterTypes(b);document.getElementById("contains").onkeyup=
function(){filterText();paginateTable(0);updateMarkers()};a=document.getElementById("table").getElementsByTagName("th");for(b=0;b<a.length;b++)a[b].addEventListener("click",function(a){sortTable(this.className.match(/T_\w+/)[0],this.className.match("sort_up"),this.hasAttribute("data-float"))})}
function showDetail(a){map.panTo(a.position);markerDetail?(markerDetail.setMap(map),markerDetail.position=a.position,markerDetail.setAnimation(google.maps.Animation.BOUNCE)):markerDetail=new google.maps.Marker({position:a.position,map:map,animation:google.maps.Animation.BOUNCE,icon:"/img/pump_mark.png"});document.getElementById("detail").className="on";a=document.getElementById(a.get("id"));var b=a.getElementsByClassName("T_ADDR")[0].getAttribute("label"),c=a.getElementsByClassName("T_ADDR")[0].getElementsByTagName("a")[0].textContent,
d=a.getElementsByClassName("T_ADDR")[0].getElementsByTagName("a")[0].href,e=a.getElementsByClassName("T_LOC")[0].textContent;document.getElementById("d-title").textContent="Gasolinera '"+b+"' en "+e+", "+c;document.getElementById("d-link").href=d;b=document.getElementById("d-prices");b.innerHTML="";c=a.getElementsByTagName("td");for(d=4;d<c.length;d++)if(e=c[d].textContent){var f=c[d].className.match(/T_\w+/)[0].replace("T_",""),g=document.createElement("li");g.textContent=FUEL_OPTIONS[f].name;g.className=
"T_"+f;f=document.createElement("div");f.textContent=e;g.appendChild(f);b.appendChild(g)}b=document.getElementById("d-date");c=document.getElementById("d-clock");a=(new Date-new Date(parseInt(a.getElementsByClassName("T_DATE")[0].textContent)))/TO_DAYS;d="";e="clock";1>a?(d=" hoy",e+=" new"):(d=" hace "+Math.floor(a)+" d\u00eda"+(2<a?"s":""),e+=7>=a?" med":" old");b.textContent="Precios actualizados "+d;c.className=e;google.maps.event.addListenerOnce(map,"mousedown",function(){document.getElementById("detail").className=
"";markerDetail.setMap(null)})}
function populateInfo(){document.getElementById("info").innerHTML="<p>Se han encontrado "+Stats.n+" puntos de venta.</p>";var a=document.getElementById("summary-b"),b;for(b in Stats.types){var c=Stats.types[b],d=document.createElement("tr");d.className="data T_"+b;var e=document.createElement("td");e.textContent=FUEL_OPTIONS[b].name;d.appendChild(e);e=document.createElement("td");e.textContent=c.n;d.appendChild(e);e=document.createElement("td");e.innerHTML="<span>"+c.min.toFixed(3)+"</span>";e.className=
"price min";d.appendChild(e);e=document.createElement("td");e.innerHTML="<span>"+c.mean.toFixed(3)+"</span>";e.className="price mean";d.appendChild(e);e=document.createElement("td");e.innerHTML="<span>"+c.max.toFixed(3)+"</span>";e.className="price max";d.appendChild(e);a.appendChild(d)}}function getSelTypes(){for(var a=[],b=document.getElementById("types").getElementsByClassName("on"),c=0;c<b.length;c++)a.push(parseInt(b[c].className.split(" ")[0].split("_")[1]));return a}
function populateTable(a){var b=document.getElementById("table-data");b.innerHTML="";document.location.pathname.split("/");a=[];var c=new Date,d;for(d in data){var e=encodeName(d),f;for(f in data[d]){var g=encodeName(f),h="/gasolineras/"+e+"/"+g;a.push([f,h]);for(var p in data[d][f]){var q=data[d][f][p],l=q.label,r=document.createElement("tr");r.className="r_on";var m=document.createElement("td"),n=document.createElement("a");n.href=h;n.title="Todas las gasolineras de "+f;n.textContent=f;m.className=
"T_LOC";m.appendChild(n);r.appendChild(m);m=document.createElement("td");n=document.createElement("a");n.href="/ficha/"+e+"/"+g+"/"+encodeName(p);n.textContent=toTitle(p);n.title="Detalles de la gasolinera en "+f+", "+n.textContent;m.className="T_ADDR";m.setAttribute("label",l);if(l=getLogo(l)){var s=document.createElement("div");s.className="logo "+l;m.appendChild(s)}r.appendChild(m);m.appendChild(n);l=document.createElement("td");l.className="T_DIST";q.hasOwnProperty("latlon")&&(m=new google.maps.LatLng(q.latlon[0],
q.latlon[1]),n=new google.maps.Marker({icon:{path:google.maps.SymbolPath.CIRCLE,strokeOpacity:1,strokeWeight:1,fillOpacity:0.8,scale:6},map:map,position:m}),google.maps.event.addListener(n,"click",function(a){showDetail(this)}),n.set("price",q.options),r.id="tr-"+markers.length,l.id="td-"+markers.length,markers.push(n),l.setAttribute("data-geo",q.latlon.join(",")),l.addEventListener("click",function(){var a=markers[this.id.split("-")[1]];showDetail(a)}),n.set("id",r.id),bounds.extend(m),l.innerHTML=
"<div title='Mostrar en el mapa' class='icon locate'></div><span></span>");r.appendChild(l);l=document.createElement("td");l.className="T_DATE";m=document.createElement("div");n=new Date(q.date);s=(c-n)/TO_DAYS;m.className="icon clock med";1>s?m.className+=" new":7<s&&(m.className+=" old");l.title=n.toLocaleDateString();l.innerHTML="<span>"+n.getTime()+"</span>";l.appendChild(m);r.appendChild(l);for(var t in FUEL_OPTIONS)otd=document.createElement("td"),(l=q.options[t])?(otd.textContent=l.toFixed(3),
otd.className="T_"+t+" on"):otd.className="T_"+t,r.appendChild(otd);b.appendChild(r);Stats.add(q.options)}map.fitBounds(bounds)}}Stats.run();if(1<a.length){d=document.getElementById("cities-list");a.sort(function(a,b){return a[0].toLowerCase()<b[0].toLowerCase()?-1:a[0].toLowerCase()>b[0].toLowerCase()?1:0});for(f=0;f<a.length;f++)p=document.createElement("li"),p.innerHTML=a[f][0].link(a[f][1]),d.appendChild(p)}else document.getElementById("p-cities").style.display="none"}
function processData(a){console.log(a);var b=document.getElementById("title");if(a._near)b.textContent="Gasolineras cerca de: "+a._near,place=a._near;else{var c=decodeArray(document.location.pathname.split("/").splice(2));province=prettyName(c[0]);c[1]&&(town=prettyName(c[1]));b.textContent="Gasolineras en "+(town?town+", ":"la ")+"provincia de "+province;place=town?town+", "+province:province}data=a._data;initMap();populateTable();populateInfo();initControl();newReference(place);updateMarkers();
paginateTable(0)}window.addEventListener("load",function(){getData(processData)});function searchLocation(a){var b="",c="",d="";"object"==typeof a?(b=a.geometry.location.lat(),c=a.geometry.location.lng(),d=encodeURI(a.formatted_address)):"string"==typeof a&&(c=a.split("##"),d=c[0],b=c[1],c=c[2]);a=document.getElementById("search-d").getAttribute("value");window.location="/resultados/"+d+"/"+b+"/"+c+"/"+a}
function showLoader(){document.getElementById("results-title").textContent="Buscando\u2026";var a=document.getElementById("results-list");a.innerHTML="";var b=new Image;b.src="/img/search-loader.gif";a.appendChild(b)}function initGeoloc(){var a=document.getElementById("current-loc");navigator.geolocation?a.addEventListener("click",loadCurrentPosition):a.style.display="none"}
function showResult(a,b){document.getElementById("results").style.display="block";var c=document.getElementById("results-list");c.innerHTML="";if(b==google.maps.GeocoderStatus.OK){for(var d=0,e=0,f=0;f<a.length;f++){var g=a[f].formatted_address;if(g.match(/Espa\u00f1a$/)){console.log(typeof a[f]);d++;var e=f,h=document.createElement("li"),p=document.createElement("a");h.appendChild(p);p.textContent=g;p.href="#";p.setAttribute("loc",[a[f].formatted_address,a[f].geometry.location.lat(),a[f].geometry.location.lng()].join("##"));
p.addEventListener("click",function(){searchLocation(this.getAttribute("loc"))});c.appendChild(h)}}if(1==d){searchLocation(a[e]);return}if(1<d){document.getElementById("results-title").textContent="Encontrados "+d+" lugares:";return}}c.innerHTML="<li>No se ha podido encontrar el lugar. Int\u00e9ntalo de nuevo</li>"}
function loadCurrentPosition(){showLoader();navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.Geocoder;a=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);b.geocode({latLng:a},showResult)},function(a){switch(a.code){case a.PERMISSION_DENIED:console.log("User denied the request for Geolocation.");break;case a.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case a.TIMEOUT:console.log("The request to get user location timed out.");break;
case a.UNKNOWN_ERROR:console.log("An unknown error occurred.")}})}function geoCode(){showLoader();var a=document.getElementById("address").value;(new google.maps.Geocoder).geocode({address:a,region:"es"},showResult)}
function mySlider(a){function b(a){var b=a.getElementsByClassName("val")[0],c=parseFloat(a.getAttribute("newval")),g=parseFloat(a.getAttribute("max")),h=parseFloat(a.getAttribute("min"));b.style.width=(c-h)*a.clientWidth/(g-h)-5+"px";b.textContent="Radio: "+c.toFixed(1)+" km.";a.setAttribute("value",c)}a.style.position="relative";var c=document.createElement("div");c.style.position="absolute";c.style.left="0";c.style.top="0";c.textContent="Radio: "+a.getAttribute("value")+" km.";c.className="val";
a.appendChild(c);c=document.createElement("div");c.style.position="absolute";c.style.left="0";c.style.top="0";c.className="new-val";c.style.display="none";a.appendChild(c);a.setAttribute("newval",a.getAttribute("value"));b(a);a.addEventListener("mousemove",function(a){var b=this.getElementsByClassName("new-val")[0];b.style.display="block";var c=a.clientX-this.getBoundingClientRect().left;b.style.width=c-5+"px";a=parseFloat(this.getAttribute("max"));var g=parseFloat(this.getAttribute("min")),h=parseFloat(this.getAttribute("step")),
c=g+c*(a-g)/this.clientWidth,c=parseInt(c/h)*h;c<g&&(c=g);c>a&&(c=a);b.textContent="Radio: "+c.toFixed(1)+" km.";this.setAttribute("newval",c)});a.addEventListener("click",function(a){this.getElementsByClassName("new-val")[0].style.display="none";b(this)});a.addEventListener("mouseout",function(a){this.getElementsByClassName("new-val")[0].style.display="none"})}
window.addEventListener("load",function(){for(var a=document.getElementsByClassName("my-slider"),b=0;b<a.length;b++)mySlider(a[b]);if(a=document.getElementById("map")){a=a.getElementsByClassName("prov");for(b=0;b<a.length;b++)a[b].addEventListener("click",function(){})}initGeoloc()});
