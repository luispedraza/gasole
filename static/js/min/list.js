eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36));};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e];}];e=function(){return '\\w+';};c=1;};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p;}('5 J(b,a){b.17().V(J,n.o.32);4.F=b;4.2F=b.17().2r();4.P=a;4.B=s;4.q=s;4.X=s;4.1j=t;4.L(b.u())}J.6.2E=5(){7 d=4;7 g;7 f;4.q=3C.3x("2a");4.q.5m=4.2F;9(4.1j){4.27()}4.4I().4F.4A(4.q);n.o.z.1L(4.u(),"4i",5(){f=g});n.o.z.1E(4.q,"44",5(){g=K;f=t});n.o.z.1E(4.q,"2N",5(e){g=t;9(!f){7 c;7 b;7 a=d.F.17();n.o.z.W(a,"2N",d.F);n.o.z.W(a,"40",d.F);9(a.2C()){b=a.1w();c=d.F.1y();a.u().1V(c);1O(5(){a.u().1V(c);9(b!==s&&(a.u().1a()>b)){a.u().3O(b+1)}},3F)}e.3B=K;9(e.2n){e.2n()}}});n.o.z.1E(4.q,"2f",5(){7 a=d.F.17();n.o.z.W(a,"2f",d.F)});n.o.z.1E(4.q,"2B",5(){7 a=d.F.17();n.o.z.W(a,"2B",d.F)})};J.6.2G=5(){9(4.q&&4.q.2T){4.1N();n.o.z.5d(4.q);4.q.2T.55(4.q);4.q=s}};J.6.3f=5(){9(4.1j){7 a=4.28(4.B);4.q.13.1F=a.y+"A";4.q.13.1M=a.x+"A"}};J.6.1N=5(){9(4.q){4.q.13.38="2W"}4.1j=t};J.6.27=5(){9(4.q){7 a=4.28(4.B);4.q.13.4r=4.2V(a);9(4.F.12){4.q.2S="<4d 4a=\'"+4.2c+"\'><2a 13=\'21: 2Q; 1F: 2P; 1M: 2P; 1c: "+4.Z+"A;\'>"+4.X.1d+"</2a>"}E{4.q.2S=4.X.1d}9(1p 4.X.15==="1f"||4.X.15===""){4.q.15=4.F.17().2K()}E{4.q.15=4.X.15}4.q.13.38=""}4.1j=K};J.6.2I=5(a){4.X=a;7 b=v.3Y(0,a.2D-1);b=v.1X(4.P.p-1,b);7 c=4.P[b];4.2c=c.1W;4.Q=c.14;4.Z=c.1c;4.G=c.3T;4.1P=c.3Q||[1Q(4.Q/2,10),1Q(4.Z/2,10)];4.2l=c.3H||"3E";4.2i=c.3A||11;4.2h=c.3z||"2W";4.2g=c.3w||"3u";4.2A=c.3r||"3o";4.2U=c.3l||"5l,5h-5c";4.3j=c.54||"0 0"};J.6.3g=5(a){4.B=a};J.6.2V=5(b){7 a=[];9(!4.F.12){a.H(\'3e-4S:1W(\'+4.2c+\');\');a.H(\'3e-21:\'+4.3j+\';\')}9(1p 4.G===\'4P\'){9(1p 4.G[0]===\'3b\'&&4.G[0]>0&&4.G[0]<4.Q){a.H(\'14:\'+(4.Q-4.G[0])+\'A; 3a-1F:\'+4.G[0]+\'A;\')}E{a.H(\'14:\'+4.Q+\'A; 37-14:\'+4.Q+\'A;\')}9(1p 4.G[1]===\'3b\'&&4.G[1]>0&&4.G[1]<4.Z){a.H(\'1c:\'+(4.Z-4.G[1])+\'A; 3a-1M:\'+4.G[1]+\'A;\')}E{a.H(\'1c:\'+4.Z+\'A; 1d-35:1e;\')}}E{a.H(\'14:\'+4.Q+\'A; 37-14:\'+4.Q+\'A; 1c:\'+4.Z+\'A; 1d-35:1e;\')}a.H(\'4G:4E; 1F:\'+b.y+\'A; 1M:\'+b.x+\'A; 4C:\'+4.2l+\'; 21:2Q; 1I-1r:\'+4.2i+\'A; 1I-4z:\'+4.2U+\'; 1I-4y:\'+4.2g+\'; 1I-13:\'+4.2A+\'; 1d-4x:\'+4.2h+\';\');j a.4v("")};J.6.28=5(b){7 a=4.3d().22(b);a.x-=4.1P[1];a.y-=4.1P[0];j a};5 D(a){4.16=a;4.O=a.u();4.T=a.3h();4.Y=a.2R();4.1g=a.3k();4.12=a.3i();4.k=[];4.B=s;4.2b=s;4.18=I J(4,a.20())}D.6.41=5(){j 4.k.p};D.6.1D=5(){j 4.k};D.6.2O=5(){j 4.B};D.6.u=5(){j 4.O};D.6.17=5(){j 4.16};D.6.1y=5(){7 i;7 b=I n.o.1q(4.B,4.B);7 a=4.1D();w(i=0;i<a.p;i++){b.V(a[i].S())}j b};D.6.1C=5(){4.18.L(s);4.k=[];1Z 4.k};D.6.1B=5(e){7 i;7 c;7 b;9(4.2M(e)){j t}9(!4.B){4.B=e.S();4.1Y()}E{9(4.1g){7 l=4.k.p+1;7 a=(4.B.U()*(l-1)+e.S().U())/l;7 d=(4.B.19()*(l-1)+e.S().19())/l;4.B=I n.o.1o(a,d);4.1Y()}}e.1n=K;4.k.H(e);c=4.k.p;b=4.16.1w();9(b!==s&&4.O.1a()>b){9(e.u()!==4.O){e.L(4.O)}}E 9(c<4.Y){9(e.u()!==4.O){e.L(4.O)}}E 9(c===4.Y){w(i=0;i<c;i++){4.k[i].L(s)}}E{e.L(s)}4.2L();j K};D.6.2J=5(a){j 4.2b.34(a.S())};D.6.1Y=5(){7 a=I n.o.1q(4.B,4.B);4.2b=4.16.2e(a)};D.6.2L=5(){7 c=4.k.p;7 a=4.16.1w();9(a!==s&&4.O.1a()>a){4.18.1N();j}9(c<4.Y){4.18.1N();j}7 b=4.16.20().p;7 d=4.16.36()(4.k,b);4.18.3g(4.B);4.18.2I(d);4.18.27()};D.6.2M=5(a){7 i;9(4.k.1m){j 4.k.1m(a)!==-1}E{w(i=0;i<4.k.p;i++){9(a===4.k[i]){j K}}}j t};5 8(a,c,b){4.V(8,n.o.32);c=c||[];b=b||{};4.k=[];4.C=[];4.1s=[];4.1k=s;4.1t=t;4.T=b.3X||3W;4.Y=b.3V||2;4.1R=b.2z||s;4.P=b.3U||[];4.29=b.15||"";4.1K=K;9(b.2y!==1f){4.1K=b.2y}4.1g=t;9(b.2x!==1f){4.1g=b.2x}4.1b=t;9(b.2v!==1f){4.1b=b.2v}4.12=t;9(b.2u!==1f){4.12=b.2u}4.1A=b.3S||8.2s;4.1v=b.3R||8.2p;4.1u=b.3P||8.2o;4.1U=b.3J||8.2m;4.1S=b.3I||8.2k;4.1z=b.3G||8.2j;4.1T=b.3D||"N";9(3K.3L.3M().1m("3N")!==-1){4.1S=4.1z}4.2H();4.2w(c,K);4.L(a)}8.6.2E=5(){7 a=4;4.1k=4.u();4.1t=K;4.1h();4.1s=[n.o.z.1L(4.u(),"3y",5(){a.1x(t);9(4.1a()===(4.2q("3v")||0)||4.1a()===4.2q("2z")){n.o.z.W(4,"2t")}}),n.o.z.1L(4.u(),"2t",5(){a.1l()})]};8.6.2G=5(){7 i;w(i=0;i<4.k.p;i++){9(4.k[i].u()!==4.1k){4.k[i].L(4.1k)}}w(i=0;i<4.C.p;i++){4.C[i].1C()}4.C=[];w(i=0;i<4.1s.p;i++){n.o.z.3t(4.1s[i])}4.1s=[];4.1k=s;4.1t=t};8.6.3f=5(){};8.6.2H=5(){7 i,1r;9(4.P.p>0){j}w(i=0;i<4.1u.p;i++){1r=4.1u[i];4.P.H({1W:4.1A+(i+1)+"."+4.1v,14:1r,1c:1r})}};8.6.3s=5(){7 i;7 a=4.1D();7 b=I n.o.1q();w(i=0;i<a.p;i++){b.V(a[i].S())}4.u().1V(b)};8.6.3h=5(){j 4.T};8.6.3Z=5(a){4.T=a};8.6.2R=5(){j 4.Y};8.6.3q=5(a){4.Y=a};8.6.1w=5(){j 4.1R};8.6.3p=5(a){4.1R=a};8.6.20=5(){j 4.P};8.6.42=5(a){4.P=a};8.6.2K=5(){j 4.29};8.6.43=5(a){4.29=a};8.6.2C=5(){j 4.1K};8.6.3n=5(a){4.1K=a};8.6.3k=5(){j 4.1g};8.6.3m=5(a){4.1g=a};8.6.46=5(){j 4.1b};8.6.47=5(a){4.1b=a};8.6.5k=5(){j 4.1v};8.6.5i=5(a){4.1v=a};8.6.5g=5(){j 4.1A};8.6.5f=5(a){4.1A=a};8.6.5b=5(){j 4.1u};8.6.5a=5(a){4.1u=a};8.6.36=5(){j 4.1U};8.6.59=5(a){4.1U=a};8.6.3i=5(){j 4.12};8.6.57=5(a){4.12=a};8.6.51=5(){j 4.1z};8.6.50=5(a){4.1z=a};8.6.2r=5(){j 4.1T};8.6.4Z=5(a){4.1T=a};8.6.1D=5(){j 4.k};8.6.4X=5(){j 4.k.p};8.6.4V=5(){j 4.C};8.6.4U=5(){j 4.C.p};8.6.1B=5(b,a){4.2d(b);9(!a){4.1l()}};8.6.2w=5(b,a){7 i;w(i=0;i<b.p;i++){4.2d(b[i])}9(!a){4.1l()}};8.6.2d=5(b){9(b.4T()){7 a=4;n.o.z.1L(b,"4R",5(){9(a.1t){4.1n=t;a.1h()}})}b.1n=t;4.k.H(b)};8.6.4Q=5(c,a){7 b=4.26(c);9(!a&&b){4.1h()}j b};8.6.4O=5(a,c){7 i,r;7 b=t;w(i=0;i<a.p;i++){r=4.26(a[i]);b=b||r}9(!c&&b){4.1h()}j b};8.6.26=5(b){7 i;7 a=-1;9(4.k.1m){a=4.k.1m(b)}E{w(i=0;i<4.k.p;i++){9(b===4.k[i]){a=i;4N}}}9(a===-1){j t}b.L(s);4.k.4K(a,1);j K};8.6.4J=5(){4.1x(K);4.k=[]};8.6.1h=5(){7 a=4.C.4H();4.C=[];4.1x(t);4.1l();1O(5(){7 i;w(i=0;i<a.p;i++){a[i].1C()}},0)};8.6.2e=5(d){7 f=4.3d();7 c=I n.o.1o(d.23().U(),d.23().19());7 a=I n.o.1o(d.24().U(),d.24().19());7 e=f.22(c);e.x+=4.T;e.y-=4.T;7 g=f.22(a);g.x-=4.T;g.y+=4.T;7 b=f.2X(e);7 h=f.2X(g);d.V(b);d.V(h);j d};8.6.1l=5(){4.25(0)};8.6.1x=5(a){7 i,M;w(i=0;i<4.C.p;i++){4.C[i].1C()}4.C=[];w(i=0;i<4.k.p;i++){M=4.k[i];M.1n=t;9(a){M.L(s)}}};8.6.33=5(b,e){7 R=4D;7 g=(e.U()-b.U())*v.1H/1G;7 f=(e.19()-b.19())*v.1H/1G;7 a=v.1J(g/2)*v.1J(g/2)+v.31(b.U()*v.1H/1G)*v.31(e.U()*v.1H/1G)*v.1J(f/2)*v.1J(f/2);7 c=2*v.4B(v.30(a),v.30(1-a));7 d=R*c;j d};8.6.2Z=5(b,a){j a.34(b.S())};8.6.39=5(c){7 i,d,N,1e;7 a=4L;7 b=s;w(i=0;i<4.C.p;i++){N=4.C[i];1e=N.2O();9(1e){d=4.33(1e,c.S());9(d<a){a=d;b=N}}}9(b&&b.2J(c)){b.1B(c)}E{N=I D(4);N.1B(c);4.C.H(N)}};8.6.25=5(e){7 i,M;7 d;7 c=4;9(!4.1t){j}9(e===0){n.o.z.W(4,"4M",4);9(1p 4.1i!=="1f"){4w(4.1i);1Z 4.1i}}9(4.u().1a()>3){d=I n.o.1q(4.u().1y().24(),4.u().1y().23())}E{d=I n.o.1q(I n.o.1o(3c.4u,-2Y.4t),I n.o.1o(-3c.4s,2Y.4q))}7 a=4.2e(d);7 b=v.1X(e+4.1S,4.k.p);w(i=e;i<b;i++){M=4.k[i];9(!M.1n&&4.2Z(M,a)){9(!4.1b||(4.1b&&M.4W())){4.39(M)}}}9(b<4.k.p){4.1i=1O(5(){c.25(b)},0)}E{1Z 4.1i;n.o.z.W(4,"4p",4)}};8.6.V=5(d,c){j(5(b){7 a;w(a 4Y b.6){4.6[a]=b.6[a]}j 4}).4o(d,[c])};8.2m=5(a,c){7 f=0;7 b="";7 d=a.p.4n();7 e=d;4m(e!==0){e=1Q(e/10,10);f++}f=v.1X(f,c);j{1d:d,2D:f,15:b}};8.2k=52;8.2j=4l;8.2s="4k://n-o-4j-58-4h.4g.4f/4e/4c/5e/4b/m";8.2p="49";8.2o=[53,56,5j,48,45];',62,333,'||||this|function|prototype|var|MarkerClusterer|if||||||||||return|markers_|||google|maps|length|div_||null|false|getMap|Math|for|||event|px|center_|clusters_|Cluster|else|cluster_|anchor_|push|new|ClusterIcon|true|setMap|marker|cluster|map_|styles_|height_||getPosition|gridSize_|lat|extend|trigger|sums_|minClusterSize_|width_|||printable_|style|height|title|markerClusterer_|getMarkerClusterer|clusterIcon_|lng|getZoom|ignoreHidden_|width|text|center|undefined|averageCenter_|repaint|timerRefStatic|visible_|activeMap_|redraw_|indexOf|isAdded|LatLng|typeof|LatLngBounds|size|listeners_|ready_|imageSizes_|imageExtension_|getMaxZoom|resetViewport_|getBounds|batchSizeIE_|imagePath_|addMarker|remove|getMarkers|addDomListener|top|180|PI|font|sin|zoomOnClick_|addListener|left|hide|setTimeout|anchorIcon_|parseInt|maxZoom_|batchSize_|clusterClass_|calculator_|fitBounds|url|min|calculateBounds_|delete|getStyles|position|fromLatLngToDivPixel|getNorthEast|getSouthWest|createClusters_|removeMarker_|show|getPosFromLatLng_|title_|div|bounds_|url_|pushMarkerTo_|getExtendedBounds|mouseover|fontWeight_|textDecoration_|textSize_|BATCH_SIZE_IE|BATCH_SIZE|textColor_|CALCULATOR|stopPropagation|IMAGE_SIZES|IMAGE_EXTENSION|get|getClusterClass|IMAGE_PATH|idle|printable|ignoreHidden|addMarkers|averageCenter|zoomOnClick|maxZoom|fontStyle_|mouseout|getZoomOnClick|index|onAdd|className_|onRemove|setupStyles_|useStyle|isMarkerInClusterBounds|getTitle|updateIcon_|isMarkerAlreadyAdded_|click|getCenter|0px|absolute|getMinimumClusterSize|innerHTML|parentNode|fontFamily_|createCss|none|fromDivPixelToLatLng|178|isMarkerInBounds_|sqrt|cos|OverlayView|distanceBetweenPoints_|contains|align|getCalculator|line|display|addToClosestCluster_|padding|number|85|getProjection|background|draw|setCenter|getGridSize|getPrintable|backgroundPosition_|getAverageCenter|fontFamily|setAverageCenter|setZoomOnClick|normal|setMaxZoom|setMinimumClusterSize|fontStyle|fitMapToMarkers|removeListener|bold|minZoom|fontWeight|createElement|zoom_changed|textDecoration|textSize|cancelBubble|document|clusterClass|black|100|batchSizeIE|textColor|batchSize|calculator|navigator|userAgent|toLowerCase|msie|setZoom|imageSizes|anchorIcon|imageExtension|imagePath|anchor|styles|minimumClusterSize|60|gridSize|max|setGridSize|clusterclick|getSize|setStyles|setTitle|mousedown|90|getIgnoreHidden|setIgnoreHidden|78|png|src|images|trunk|img|svn|com|googlecode|v3|bounds_changed|utility|http|500|while|toString|apply|clusteringend|00048865625|cssText|08136444384544|48388434375|02070771743472|join|clearTimeout|decoration|weight|family|appendChild|atan2|color|6371|pointer|overlayMouseTarget|cursor|slice|getPanes|clearMarkers|splice|40000|clusteringbegin|break|removeMarkers|object|removeMarker|dragend|image|getDraggable|getTotalClusters|getClusters|getVisible|getTotalMarkers|in|setClusterClass|setBatchSizeIE|getBatchSizeIE|2000||backgroundPosition|removeChild||setPrintable|library|setCalculator|setImageSizes|getImageSizes|serif|clearInstanceListeners|markerclustererplus|setImagePath|getImagePath|sans|setImageExtension|66|getImageExtension|Arial|className'.split('|'),0,{}));var FUEL_OPTIONS={"1":{"short":"G95","name":"Gasolina 95"},"3":{"short":"G98","name":"Gasolina 98"},"4":{"short":"GOA","name":"Gasóleo Automoción"},"5":{"short":"NGO","name":"Nuevo Gasóleo A"},"6":{"short":"GOB","name":"Gasóleo B"},"7":{"short":"GOC","name":"Gasóleo C"},"8":{"short":"BIOD","name":"Biodiésel"}};var FUEL_COLORS={"G95":"#006633","G98":"#339933","GOA":"#000","NGO":"#aaa","GOB":"#CC3333","GOC":"#FF3300","BIOD":"#FFCC33"};var FUEL_NAMES={"G95":"Gasolina 95","G98":"Gasolina 98","GOA":"Gasóleo A","NGO":"Nuevo Gasóleo A","GOB":"Gasóleo B","GOC":"Gasóleo C","BIOD":"Biodiésel"};function toTitle(s){return s.replace(" [N]","").replace(/^CARRETERA ?|^CR\.? ?/i,"CTRA. ").replace(/(CTRA. )+/i,"CTRA. ").replace(/^AVENIDA ?|^AV. ?/i,"AVDA. ").replace(/^POLIGONO INDUSTRIAL ?|POLIGONO ?|P\.I\. ?/i,"POL. IND. ").replace(/^CALLE |^CL\.? ?|C\/ ?/i,"C/ ").replace(/^RONDA |^RD /i,"RDA. ").replace(/^AUTOPISTA (AUTOPISTA ?)?/i,"AU. ").replace(/^PLAZA ?/i,"PL. ").replace(/^PASEO (PASEO ?)?/i,"Pº ").replace(/^TRAVESS?[IÍ]A /i,"TRAV. ").replace(/^V[ií]A (V[IÍ]A )?/i,"VÍA ").replace(/\B[^\d- ]+[ $]/g,function(t){return t.toLowerCase();}).replace(/\b[NAE]-.+\b/,function(t){return t.toUpperCase();}).replace(/\[D\]$/,"(m.d.)").replace(/\[I\]$/,"(m.i.)").replace(/ \[N\]$/,"");}function getLogo(label){if(label){label=label.replace(/camspa/i,"campsa");logo=label.match(/\b(abycer|agla|alcampo|andamur|a\.?n\.? energeticos|avia|bonarea|b\.?p\.?|buquerin|campsa|carmoned|carrefour|cepsa|empresoil|eroski|esclatoil|galp|gasolben|iberdoex|leclerc|makro|meroil|norpetrol|petrem|petrocat|petromiralles|petronor|repostar|repsol|saras|shell|simply|staroil|tamoil|valcarce)\b/i);if(logo)return logo[0].replace(/\./g,"").replace(/ /g,"_").toLowerCase();}return null;}function decodeName(s){return decodeURI(s).replace(/_/g," ").replace(/\|/g,"/");}function prettyName(s){if(s.match("/"))s=s.split("/")[1];if(s.match(/\)$/))s=s.match(/\(.+\)$/g)[0].replace("(","").replace(")"," ")+s.split(" (")[0];return s;}function decodeArray(a){for(var n=0;n<a.length;n++)a[n]=decodeName(a[n]);return a;}function encodeName(s){return s.replace(/\//g,"|").replace(/ /g,"_");}function checkLocalStorage(){try{return 'localStorage' in window&&window.localStorage!==null;}catch(e){return false;}}var info=null;var LOCAL_EXPIRATION=3600000;var APIS={"gasolineras":"api","resultados":"geo","ficha":"api"};function getApiData(url,key,callback){var req=new XMLHttpRequest();req.onload=function(r){info=JSON.parse(r.target.responseText);console.log("datos obtenidos: ",info);if(key){localStorage.setItem(key,JSON.stringify(info));localStorage.setItem("timestamp",new Date().getTime());}callback(info);};req.open("GET",url);req.send();}function clearCurrentStorage(){if(!checkLocalStorage())return;var pathArray=window.location.pathname.split("/");var option=pathArray[1];if(option=="ficha")localStorage.removeItem(pathArray.slice(2).join("*"));}function getData(callback){var pathArray=window.location.pathname.split("/");var option=pathArray[1];var where1=pathArray[2];var where2=pathArray[3];var key=null;if(checkLocalStorage()){var timestamp=localStorage.timestamp;if(timestamp&&(new Date().getTime()-parseInt(timestamp))>LOCAL_EXPIRATION){console.log("datos antiguos");localStorage.clear();}var storedData=null;if(option=="resultados"){key=where1;storedData=localStorage[key];}else if(option=="gasolineras"){if(where2){key=[where1,where2].join("*");storedData=localStorage[key];if(!storedData)storedData=localStorage[where1];}else{key=where1;storedData=localStorage[key];}}else if(option=="ficha"){var where3=pathArray[4];key=[where1,where2,where3].join("*");storedData=localStorage[key];}if(storedData)info=JSON.parse(storedData);}if(info){if((option=="gasolineras")&&where2){var prov=decodeName(where1);var town=decodeName(where2);tempData={};tempData._data={};tempData._data[prov]={};tempData._data[prov][town]=info._data[prov][town];info=tempData;}console.log("datos recuperados: ",info);callback(info);}else{console.log(key);getApiData(document.URL.replace(option,APIS[option]),key,callback);}return null;}var data;var map;var place="";var markers=[];var province="";var town="";var markerCenter;var pagerN=15;var pagerCurrent=null;var infoWindow=null;var cluster=null;var Stats={types:{},n:0,init:false,add:function(station){if(this.init)return;for(var t in station){var val=station[t];if(this.types.hasOwnProperty(t)){var data=this.types[t];if(val>data.max)data.max=val;else if(val<data.min)data.min=val;data.mean=(data.mean*data.n+val)/(data.n+1);data.n++;}else this.types[t]={max:val,min:val,mean:val,n:1};}this.n++;},run:function(){var N=0;for(var t in this.types){N+=this.types[t].n;this.types[t].range=this.types[t].max-this.types[t].min;}for(var t in this.types)this.types[t].w=this.types[t].n/N;this.init=true;}};var COLORS={min:"#36AE34",minStroke:"#288627",max:"#f00",maxStroke:"#D30000",mu:"#FF9933",muStroke:"#D07B26"};function newReference(loc){if(infoWindow)infoWindow.close();var location=loc;if(!location)location=document.getElementById("from").value;var geocoder=new google.maps.Geocoder();geocoder.geocode({'address':location},function(res,stat){var infoDiv=document.getElementById("distance-info");if(stat==google.maps.GeocoderStatus.OK){if(!markerCenter){markerCenter=new google.maps.Marker({map:map,position:res[0].geometry.location,draggable:true});google.maps.event.addListener(markerCenter,'click',function(e){if(infoWindow)infoWindow.close();infoWindow=new google.maps.InfoWindow({content:"Punto de referencia:<br /> "+this.place.bold()});infoWindow.open(map,this);});}else markerCenter.setPosition(res[0].geometry.location);markerCenter.set("place",res[0].formatted_address);map.panTo(res[0].geometry.location);if(!loc)map.setZoom(14);calcDistances();var nearest=document.getElementById("table-data").getElementsByTagName("tr")[0];infoDiv.innerHTML="La gasolinera más próxima a "+res[0].formatted_address+" se encuentra en "+nearest.getElementsByClassName("T_ADDR")[0].innerHTML.replace(/ \[.\]/g,"");return;}infoDiv.innerHTML="No se ha podido localizar la referencia.";});}function paginateTable(index){var rows=document.getElementById("table-data").getElementsByClassName("r_on");var pager=document.getElementById("pager-links");if(!rows.length){pager.innerHTML="<p>No hay resultados coincidentes con los criterios de búsqueda.<br>Comprueba el filtro y tipos de combustible seleccionados.</p>";return;}if(index==="more")index=Math.min(pagerCurrent+pagerN,parseInt(rows.length/pagerN)*pagerN);else if(index==="less")index=Math.max(pagerCurrent-pagerN,0);if(index>=rows.length)return;pager.innerHTML="";for(var r=0;r<rows.length;r++){rows[r].className=rows[r].className.replace(" p_off","");if((r<index)||(r>=index+pagerN))rows[r].className+=" p_off";if(r%pagerN==0){var p=document.createElement("div");p.innerHTML=((r+1)+"<br/>"+Math.min(r+pagerN,rows.length));p.setAttribute("onclick","javascript:paginateTable("+r+");");(r==index)?(p.className="p current"):(p.className="p");pager.appendChild(p);}}pagerCurrent=index;}function calcDistances(){var tds=document.getElementById("table-data").getElementsByClassName("T_DIST");for(var i=0;i<tds.length;i++){var latlon=tds[i].getAttribute("data-geo");if(latlon){latlon=latlon.split(",");var dlat=(latlon[0]-markerCenter.position.lat())*111.03461;var dlon=(latlon[1]-markerCenter.position.lng())*85.39383;var dist=Math.sqrt(dlat*dlat+dlon*dlon).toFixed(1);tds[i].textContent=dist;}}sortTable("T_DIST",false,true);}function mapCluster(){if(document.getElementById("cluster").checked){for(var m=0;m<markers.length;m++)if(markers[m].getMap())cluster.addMarker(markers[m]);}else{cluster.clearMarkers();updateMarkers();}}function markerColor(sel,price){var vals=[];for(var s=0;s<sel.length;s++){var current=sel[s];var p=price[current];if(Stats.types[current]&&price){var range=Stats.types[current].range;if(range){var min=Stats.types[current].min;vals.push((p-min)/range);}else vals.push(.5);}}if(vals.length==0)return null;var mean=0;for(var v=0;v<vals.length;v++)mean=((mean*v)+vals[v])/(v+1);var color=[COLORS.maxStroke,COLORS.max];if(mean<.25)color=[COLORS.minStroke,COLORS.min];else if(mean<.75)color=[COLORS.muStroke,COLORS.mu];return color;}function updateMarkers(){var rows=document.getElementById("table-data").getElementsByTagName("tr");selection=getSelTypes();for(var r=0;r<rows.length;r++){var marker=markers[rows[r].id.split("-")[1]];if(marker){if(rows[r].className.match("r_on")){var color=markerColor(selection,marker.get("price"));if(color){marker.setMap(map);marker.icon.strokeColor=color[0];marker.icon.fillColor=color[1];continue;}}marker.setMap(null);}}}function initMap(){var mapOptions={center:new google.maps.LatLng(40.400,3.6833),zoom:8,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("google_map"),mapOptions);cluster=new MarkerClusterer(map);}function sortTable(cname,reverse,isfloat){if(typeof reverse=="undefined")reverse=false;function quickSort(a){if(a.length<=1)return a;var npivot=Math.floor(Math.random()*a.length);for(var p=npivot+1;p<a.length;p++)if(a[p][0]!=a[npivot][0])break;var pivot=a.splice(p-1,1);var less=[];var greater=[];for(var i=0;i<a.length;i++)if(a[i][0]<=pivot[0][0])less.push(a[i]);else greater.push(a[i]);return quickSort(less).concat(pivot,quickSort(greater));}var table_data=document.getElementById("table-data");var values=table_data.getElementsByClassName(cname);var array=[];for(var v=0;v<values.length;v++)if(values[v].textContent){var newval=(isfloat?parseFloat(values[v].textContent):values[v].textContent);array.push([newval,v]);}array=quickSort(array);if(reverse)array.reverse();var rows=table_data.getElementsByTagName("tr");var static_rows=[];for(var r=0;r<rows.length;r++)static_rows.push(rows[r]);for(var e=0;e<array.length;e++)table_data.insertBefore(static_rows[array[e][1]],table_data.children[e]);var headers=document.getElementById("table").getElementsByTagName("th");for(var h=0;h<headers.length;h++){headers[h].className=headers[h].className.replace(" sort_up","").replace(" sort_down","");if(headers[h].className.match(cname))headers[h].className=headers[h].className+(reverse?" sort_down":" sort_up");}paginateTable(0);}function filterTypes(filter){for(var i=0;i<filter.length;i++){var f=filter[i].split(" ");var type=f[0];var c_off=type+" off";var c_on=type+" on";var c_na=type;var cells=document.getElementById("table").getElementsByClassName(type);for(var c=0;c<cells.length;c++)if(f[1]=="off")cells[c].className=c_off;else if(cells[c].textContent.length>0)cells[c].className=c_on;else cells[c].className=c_na;}var rows=document.getElementById("table-data").getElementsByTagName("tr");for(var r=0;r<rows.length;r++)rows[r].className=rows[r].getElementsByClassName("on").length?"r_on":"r_off";}function filterText(){function cleanFilter(s){return s.toLowerCase().replace(/[áàä]/g,"a").replace(/[éèë]/g,"e").replace(/[íìï]/g,"i").replace(/[óòö]/g,"o").replace(/[úùü]/g,"u");}var filtervalue=document.getElementById("contains").value;if(filtervalue.length){var terms=filtervalue.split(/ +/);var rows=document.getElementById("table-data").getElementsByTagName("tr");for(var f=0;f<rows.length;f++){var row=rows[f];if(row.className=="r_off")continue;for(var t=0;t<terms.length;t++)if(terms[t].length){var found=false;var term=RegExp(cleanFilter(terms[t]));var cells=row.getElementsByTagName("td");for(var c=0;c<2;c++)found=found||(term.exec(cleanFilter(cells[c].textContent))!=null);row.className=found?"r_on":"f_off";if(!found)break;}}}else{var rows=document.getElementById("table-data").getElementsByClassName("f_off");for(var f=0;f<rows.length;f++)rows[f].className="r_on";}}function initControl(){var filterT=document.getElementById("fuel-type").getElementsByTagName("li");var filter=[];for(var f=0;f<filterT.length;f++)if(Stats.types[filterT[f].className.split(" ")[0].split("_")[1]]){filter.push(filterT[f].className);filterT[f].addEventListener("click",function(){var cname=this.className.split(" ");var newCname=cname[0]+" "+((cname[1]=="on")?"off":"on");this.className=newCname;filterTypes([newCname]);filterText();paginateTable(0);updateMarkers();});}else{filter.push(filterT[f].className.replace("on","off"));filterT[f].className="disabled";}filterTypes(filter);document.getElementById("contains").onkeyup=function(){filterText();paginateTable(0);updateMarkers();};var heads=document.getElementById("table").getElementsByTagName("th");for(var h=0;h<heads.length;h++)heads[h].addEventListener("click",function(ev){sortTable(this.className.match(/T_\w+/)[0],this.className.match("sort_up"),this.hasAttribute("data-float"));});}function showDetail(marker){map.panTo(marker.position);map.setZoom(14);var det=document.getElementById("detail");det.className="on";var row=document.getElementById(marker.get("id"));var label=row.getElementsByClassName("T_ADDR")[0].getAttribute("label");var address=row.getElementsByClassName("T_ADDR")[0].getElementsByTagName("a")[0].textContent;var link=row.getElementsByClassName("T_ADDR")[0].getElementsByTagName("a")[0].href;var city=row.getElementsByClassName("T_LOC")[0].textContent;document.getElementById("d-title").textContent="Gasolinera '"+label+"' en "+city+", "+address;document.getElementById("d-link").href=link;var priceList=document.getElementById("d-prices");priceList.innerHTML="";var prices=row.getElementsByClassName("price");for(var p=0;p<prices.length;p++){var t=prices[p].className.match(/T_\w+/)[0].replace("T_","");var newL=document.createElement("li");newL.textContent=FUEL_NAMES[t];var newP=document.createElement("div");newP.textContent=prices[p].textContent;newL.appendChild(newP);priceList.appendChild(newL);}google.maps.event.addListenerOnce(map,"mousedown",function(){document.getElementById("detail").className="";});}function populateInfo(){var divInfo=document.getElementById("info");divInfo.innerHTML="<p>Se han encontrado "+Stats.n+" puntos de venta.</p>";var divSum=document.getElementById("summary");for(var t in Stats.types){var data=Stats.types[t];var tr=document.createElement("tr");tr.className="data T_"+t;var td=document.createElement("td");td.textContent=FUEL_OPTIONS[t].name;tr.appendChild(td);td=document.createElement("td");td.textContent=data.n;tr.appendChild(td);td=document.createElement("td");td.textContent=data.min.toFixed(3);td.className="price min";tr.appendChild(td);td=document.createElement("td");td.textContent=data.mean.toFixed(3);td.className="price mean";tr.appendChild(td);td=document.createElement("td");td.textContent=data.max.toFixed(3);td.className="price max";tr.appendChild(td);divSum.appendChild(tr);}}function getSelTypes(){var res=[];var types=document.getElementById("types").getElementsByClassName("on");for(var t=0;t<types.length;t++)res.push(parseInt(types[t].className.split(" ")[0].split("_")[1]));return res;}function populateTable(types){var table=document.getElementById("table-data");table.innerHTML="";var path=document.location.pathname.split("/");var cities=[];for(var p in data){var p_link=encodeName(p);for(var t in data[p]){var t_link=encodeName(t);var s_link="/gasolineras/"+p_link+"/"+t_link;cities.push([t,s_link]);for(var s in data[p][t]){var dataPTS=data[p][t][s];var label=dataPTS.label;var tr=document.createElement("tr");tr.className="r_on";var td_town=document.createElement("td");var a_town=document.createElement("a");a_town.href=s_link;a_town.title="Todas las gasolineras de "+t;a_town.textContent=t.toUpperCase();td_town.className="T_LOC";td_town.appendChild(a_town);tr.appendChild(td_town);var td_s=document.createElement("td");var a_s=document.createElement("a");a_s.href="/ficha/"+p_link+"/"+t_link+"/"+encodeName(s);a_s.textContent=toTitle(s);a_s.title="Detalles de la gasolinera en "+t+", "+a_s.textContent;td_s.appendChild(a_s);td_s.className="T_ADDR";td_s.setAttribute("label",label);var logo=getLogo(label);if(logo)td_s.style.backgroundImage="url('/img/logos/"+logo+"_mini.png')";tr.appendChild(td_s);var td_dist=document.createElement("td");td_dist.className="T_DIST";if(dataPTS.hasOwnProperty("latlon")){var pos=new google.maps.LatLng(dataPTS.latlon[0],dataPTS.latlon[1]);var options={icon:{path:google.maps.SymbolPath.CIRCLE,strokeOpacity:1.0,strokeWeight:2,fillOpacity:.7,scale:5},map:map,position:pos};var marker=new google.maps.Marker(options);google.maps.event.addListener(marker,'click',function(e){showDetail(this);});marker.set("price",dataPTS.options);tr.id="tr-"+markers.length;td_dist.id="td-"+markers.length;markers.push(marker);td_dist.setAttribute("data-geo",dataPTS.latlon.join(","));td_dist.addEventListener("click",function(){var marker=markers[this.id.split("-")[1]];showDetail(marker);});marker.set("id",tr.id);}tr.appendChild(td_dist);for(var o in FUEL_OPTIONS){otd=document.createElement("td");var price=dataPTS.options[o];if(price){otd.textContent=price.toFixed(3);otd.className="T_"+o+" on";}else otd.className="T_"+o;tr.appendChild(otd);}table.appendChild(tr);Stats.add(dataPTS.options);}}}Stats.run();if(cities.length>1){var citiesList=document.getElementById("cities-list");cities.sort(function(a,b){if(a[0].toLowerCase()<b[0].toLowerCase())return -1;if(a[0].toLowerCase()>b[0].toLowerCase())return 1;return 0;});for(var c=0;c<cities.length;c++){var newCity=document.createElement("li");newCity.innerHTML=cities[c][0].link(cities[c][1]);citiesList.appendChild(newCity);}}else document.getElementById("p-cities").style.display="none";}function processData(info){console.log(info);var h1=document.getElementById("title");if(info._near){h1.textContent="Gasolineras cerca de: "+info._near;place=info._near;}else{var pts=decodeArray(document.location.pathname.split("/").splice(2));province=prettyName(pts[0]);if(pts[1])town=prettyName(pts[1]);h1.textContent="Gasolineras en "+(town?(town+", "):"la ")+"provincia de "+province;place=(town?(town+", "+province):province);}data=info._data;initMap();populateTable();populateInfo();initControl();newReference(place);updateMarkers();paginateTable(0);}window.addEventListener("load",function(){getData(processData);});function searchLocation(loc){var lat="",lon="",address="";if(typeof loc=="object"){lat=loc.geometry.location.lat();lon=loc.geometry.location.lng();address=encodeURI(loc.formatted_address);}else if(typeof loc=="string"){var temp=loc.split("##");address=temp[0];lat=temp[1];lon=temp[2];}var d=document.getElementById("search-d").getAttribute("value");window.location="/resultados/"+address+"/"+lat+"/"+lon+"/"+d;}function showLoader(){document.getElementById("results-title").textContent="Buscando…";var div=document.getElementById("results-list");div.innerHTML="";var img=new Image();img.src="/img/search-loader.gif";div.appendChild(img);}function initGeoloc(){var loc=document.getElementById("current-loc");if(!navigator.geolocation)loc.style.display="none";else loc.addEventListener("click",loadCurrentPosition);}function showResult(r,s){var resultsDiv=document.getElementById("results");resultsDiv.style.display="block";var resultsList=document.getElementById("results-list");resultsList.innerHTML="";if(s==google.maps.GeocoderStatus.OK){var valid=0,added=0;for(var i=0;i<r.length;i++){var addr=r[i].formatted_address;if(addr.match(/España$/)){console.log(typeof r[i]);valid++;added=i;var newL=document.createElement("li");var newA=document.createElement("a");newL.appendChild(newA);newA.textContent=addr;newA.href="#";newA.setAttribute("loc",[r[i].formatted_address,r[i].geometry.location.lat(),r[i].geometry.location.lng()].join("##"));newA.addEventListener("click",function(){searchLocation(this.getAttribute("loc"));});resultsList.appendChild(newL);}}if(valid==1){searchLocation(r[added]);return;}else if(valid>1){document.getElementById("results-title").textContent="Encontrados "+valid+" lugares:";return;};}resultsList.innerHTML="<li>No se ha podido encontrar el lugar. Inténtalo de nuevo</li>";}function loadCurrentPosition(){showLoader();navigator.geolocation.getCurrentPosition(showPosition,showError);function showPosition(pos){var geocoder=new google.maps.Geocoder();var latlng=new google.maps.LatLng(pos.coords.latitude,pos.coords.longitude);geocoder.geocode({'latLng':latlng},showResult);}function showError(e){switch(e.code){case e.PERMISSION_DENIED:console.log("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case e.TIMEOUT:console.log("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:console.log("An unknown error occurred.");break;}}}function geoCode(){showLoader();var l=document.getElementById("address").value;var geocoder=new google.maps.Geocoder();geocoder.geocode({'address':l,'region':'es'},showResult);}function mySlider(div){function updateSlider(s){var valdiv=s.getElementsByClassName("val")[0];var newval=parseFloat(s.getAttribute("newval"));var max=parseFloat(s.getAttribute("max"));var min=parseFloat(s.getAttribute("min"));var width=(newval-min)*s.clientWidth/(max-min);valdiv.style.width=(width-5)+"px";valdiv.textContent="Radio: "+newval.toFixed(1)+" km.";s.setAttribute("value",newval);}div.style.position="relative";var valdiv=document.createElement("div");valdiv.style.position="absolute";valdiv.style.left="0";valdiv.style.top="0";valdiv.textContent="Radio: "+div.getAttribute("value")+" km.";valdiv.className="val";div.appendChild(valdiv);var bar=document.createElement("div");bar.style.position="absolute";bar.style.left="0";bar.style.top="0";bar.className="new-val";bar.style.display="none";div.appendChild(bar);div.setAttribute("newval",div.getAttribute("value"));updateSlider(div);div.addEventListener("mousemove",function(e){var bar=this.getElementsByClassName("new-val")[0];bar.style.display="block";var width=e.clientX-this.getBoundingClientRect().left;bar.style.width=(width-5)+"px";var max=parseFloat(this.getAttribute("max"));var min=parseFloat(this.getAttribute("min"));var step=parseFloat(this.getAttribute("step"));var newval=min+width*(max-min)/this.clientWidth;newval=parseInt(newval/step)*step;if(newval<min)newval=min;if(newval>max)newval=max;bar.textContent="Radio: "+newval.toFixed(1)+" km.";this.setAttribute("newval",newval);});div.addEventListener("click",function(e){this.getElementsByClassName("new-val")[0].style.display="none";updateSlider(this);});div.addEventListener("mouseout",function(e){this.getElementsByClassName("new-val")[0].style.display="none";});}window.onload=function(){var sliders=document.getElementsByClassName("my-slider");for(var i=0;i<sliders.length;i++)mySlider(sliders[i]);var map=document.getElementById("map");if(map){var provinces=map.getElementsByClassName("prov");for(var p=0;p<provinces.length;p++)provinces[p].addEventListener("click",function(){});}initGeoloc();};