var FUEL_OPTIONS={1:{"short":"G95",name:"Gasolina 95"},3:{"short":"G98",name:"Gasolina 98"},4:{"short":"GOA",name:"Gas\u00f3leo Automoci\u00f3n"},5:{"short":"NGO",name:"Nuevo Gas\u00f3leo A"},6:{"short":"GOB",name:"Gas\u00f3leo B"},7:{"short":"GOC",name:"Gas\u00f3leo C"},8:{"short":"BIOD",name:"Biodi\u00e9sel"}},FUEL_COLORS={G95:"#006633",G98:"#339933",GOA:"#000",NGO:"#aaa",GOB:"#CC3333",GOC:"#FF3300",BIOD:"#FFCC33"},PROVS={"\u00c1lava":"01",Albacete:"02",Alicante:"03","Almer\u00eda":"04",Asturias:"33",
"\u00c1vila":"05",Badajoz:"06","Balears (Illes)":"07",Barcelona:"08",Burgos:"09","C\u00e1ceres":"10","C\u00e1diz":"11",Cantabria:"39","Castell\u00f3n / Castell\u00f3":"12",Ceuta:"51","Ciudad Real":"13","C\u00f3rdoba":"14","Coru\u00f1a (A)":"15",Cuenca:"16",Girona:"17",Granada:"18",Guadalajara:"19","Guip\u00fazcoa":"20",Huelva:"21",Huesca:"22","Ja\u00e9n":"23","Le\u00f3n":"24",Lleida:"25",Lugo:"27",Madrid:"28","M\u00e1laga":"29",Melilla:"52",Murcia:"30",Navarra:"31",Ourense:"32",Palencia:"34","Palmas (Las)":"35",
Pontevedra:"36","Rioja (La)":"26",Salamanca:"37","Santa Cruz De Tenerife":"38",Segovia:"40",Sevilla:"41",Soria:"42",Tarragona:"43",Teruel:"44",Toledo:"45","Valencia / Val\u00e8ncia":"46",Valladolid:"47",Vizcaya:"48",Zamora:"49",Zaragoza:"50"};function getProvName(a){for(k in PROVS)if(PROVS[k]==a)return k}
function toTitle(a){return a.replace(" [N]","").replace(/^CARRETERA ?|^CR\.? ?/i,"CTRA. ").replace(/(CTRA. )+/i,"CTRA. ").replace(/^AVENIDA ?|^AV. ?/i,"AVDA. ").replace(/^POLIGONO INDUSTRIAL ?|POLIGONO ?|P\.I\. ?/i,"POL. IND. ").replace(/^CALLE |^CL\.? ?|C\/ ?/i,"C/ ").replace(/^RONDA |^RD /i,"RDA. ").replace(/^AUTOPISTA (AUTOPISTA ?)?/i,"AU. ").replace(/^PLAZA ?/i,"PL. ").replace(/^PASEO (PASEO ?)?/i,"P\u00ba ").replace(/^TRAVESS?[I\u00cd]A /i,"TRAV. ").replace(/^V[i\u00ed]A (V[I\u00cd]A )?/i,"V\u00cdA ").replace(/\B[^\d- ]+[ $]/g,
function(a){return a.toLowerCase()}).replace(/\b[NAE]-.+\b/,function(a){return a.toUpperCase()}).replace(/\[D\]$/,"(m.d.)").replace(/\[I\]$/,"(m.i.)").replace(/ \[N\]$/,"")}
function getLogo(a){return a&&(a=a.replace(/camspa/i,"campsa"),logo=a.match(/\b(abycer|agla|alcampo|andamur|a\.?n\.? energeticos|avia|bonarea|b\.?p\.?|buquerin|campsa|carmoned|carrefour|cepsa|empresoil|eroski|esclatoil|galp|gasolben|iberdoex|leclerc|makro|meroil|norpetrol|petrem|petrocat|petromiralles|petronor|repostar|repsol|saras|shell|simply|staroil|tamoil|valcarce)\b/i))?logo[0].replace(/\./g,"").replace(/ /g,"_").toLowerCase():null}
function decodeName(a){return decodeURI(a).replace(/_/g," ").replace(/\|/g,"/")}function prettyName(a){a.match("/")&&(a=a.split("/")[1]);a.match(/\)$/)&&(a=a.match(/\(.+\)$/g)[0].replace("(","").replace(")"," ")+a.split(" (")[0]);return a}function decodeArray(a){for(var b=0;b<a.length;b++)a[b]=decodeName(a[b]);return a}function encodeName(a){return a.replace(/\//g,"|").replace(/ /g,"_")}function checkLocalStorage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}
var info=null,LOCAL_EXPIRATION=36E5,APIS={gasolineras:"api",resultados:"geo",ficha:"api"};function getApiData(a,b,d){var f=new XMLHttpRequest;f.onload=function(a){info=JSON.parse(a.target.responseText);console.log("datos obtenidos: ",info);b&&(localStorage.setItem(b,JSON.stringify(info)),localStorage.setItem("timestamp",(new Date).getTime()));d(info)};f.open("GET",a);f.send()}
function clearCurrentStorage(){if(checkLocalStorage()){var a=window.location.pathname.split("/");"ficha"==a[1]&&localStorage.removeItem(a.slice(2).join("*"))}}
function getData(a){var b=window.location.pathname.split("/"),d=b[1],f=b[2],g=b[3],c=null;if(checkLocalStorage()){var h=localStorage.timestamp;h&&(new Date).getTime()-parseInt(h)>LOCAL_EXPIRATION&&(console.log("datos antiguos"),localStorage.clear());h=null;"resultados"==d?(c=f,h=localStorage[c]):"gasolineras"==d?g?(c=[f,g].join("*"),(h=localStorage[c])||(h=localStorage[f])):(c=f,h=localStorage[c]):"ficha"==d&&(c=[f,g,b[4]].join("*"),h=localStorage[c]);h&&(info=JSON.parse(h))}info?("gasolineras"==
d&&g&&(b=decodeName(f),g=decodeName(g),tempData={_data:{}},tempData._data[b]={},tempData._data[b][g]=info._data[b][g],info=tempData),console.log("datos recuperados: ",info),a(info)):(console.log(c),getApiData(document.URL.replace(d,APIS[d]),c,a));return null};var POINTS="un asco de lugar;deja mucho que desear;mejor evitarla;las hay mejores;tiene deficiencias;una del mont\u00f3n;est\u00e1 bien en general;por encima de la media;muy recomendable;de las mejores;\u00a1excelente!".split(";");function initMap(a){if(a){a=new google.maps.LatLng(a[0],a[1]);var b={center:a,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("google_map"),b);markerCenter=new google.maps.Marker({map:map,position:a})}}
function initPoints(){var a=document.getElementsByClassName("star");document.getElementById("c_points_div").addEventListener("mouseleave",function(){var a=parseInt(document.getElementById("c_points").value);console.log(a);a?document.getElementById("c_points_text").textContent=POINTS[a]:document.getElementById("c_points_text").textContent="no olvides asignar una puntuaci\u00f3n"});for(var b=0;b<a.length;b++)a[b].addEventListener("mouseover",function(){for(var a=parseInt(this.id.split("_")[1]),b=document.getElementsByClassName("star"),
g=1;g<b.length;g++){var c=parseInt(b[g].id.split("_")[1]);b[g].className=b[g].className.replace(" on","");c<=a&&(b[g].className+=" on")}b=document.getElementById("star_0");b.className=0==a?b.className+" on":b.className.replace(" on","");document.getElementById("c_points_text").textContent=POINTS[a]}),a[b].addEventListener("click",function(){var a=this.id.split("_")[1];document.getElementById("c_points").value=parseInt(a);for(var a=document.getElementsByClassName("star"),b=0;b<a.length;b++)a[b].className=
a[b].className.replace(" sel","");this.className+=" sel"})}function insertLogo(a){var b=getLogo(a);b?(a=document.createElement("img"),a.src="/img/logos/"+b+"_w.png",document.getElementById("station-logo").appendChild(a)):document.getElementById("station-logo").textContent=a}function initPrice(a){for(var b in a){var d=FUEL_OPTIONS[b]["short"];document.getElementById("sec_"+d).style.display="block";document.getElementById("p_"+d).textContent=a[b]}}
function fillReplyTo(a){console.log(a);var b=document.getElementById("comment-"+a);document.getElementById("replyto_name").innerHTML=b.getElementsByClassName("c_name")[0].textContent.bold();document.getElementById("replyto_msg").innerHTML=b.getElementsByClassName("c_content")[0].innerHTML;document.getElementById("replyto").style.display="block";document.getElementById("comments").scrollIntoView();document.getElementById("c_replyto").value=a;document.getElementById("section_title").style.display="none";
document.getElementById("section_points").style.display="none";document.getElementById("replyto_cancel").addEventListener("click",function(){document.getElementById("replyto").style.display="none";document.getElementById("replyto_name").innerHTML="";document.getElementById("replyto_msg").innerHTML="";document.getElementById("c_replyto").value="";document.getElementById("section_title").style.display="block";document.getElementById("section_points").style.display="block"})}
function processData(a){console.log(a);data=a._data;var b,d,f,g,c,h,n,e;for(e in data)b=e;for(var m in data[e])d=m;for(var l in data[e][m])f=l,g=data[e][m][l].date,g=data[e][m][l].label,c=data[e][m][l].hours,h=data[e][m][l].latlon,n=data[e][m][l].options;document.getElementById("address").textContent=toTitle(f)+" ("+d+", "+b+")";document.getElementById("hours").textContent=c;insertLogo(g);initMap(h);initPrice(n);g=document.getElementById("old_comments");b=a._comments;for(e=f=d=0;e<b.length;e++)m=
document.createElement("div"),m.className="c_block",m.id="block-"+b[e].id,l=document.createElement("div"),l.className="c_comment",l.id="comment-"+b[e].id,null!=b[e].points&&(c=document.createElement("div"),h=parseInt(b[e].points)/10,c.textContent='"'+POINTS[h]+'" ('+h+"/10)",0==h?c.className="c_points_0":(c.className="c_points",c.style.backgroundImage="url('/img/star_"+h+".svg')"),l.appendChild(c),d+=h,f++),c=document.createElement("div"),c.className="c_name",b[e].link?c.innerHTML="<a href='"+b[e].link+
"' rel='external nofollow'>"+b[e].name+"</a>":c.textContent=b[e].name,l.appendChild(c),c=document.createElement("div"),c.className="c_date",c.textContent=(new Date(b[e].date)).toLocaleString().split(" ")[0],l.appendChild(c),c=document.createElement("img"),c.className="c_avatar",c.src=b[e].avatar,l.appendChild(c),b[e].title&&(c=document.createElement("div"),c.className="c_title",c.textContent=b[e].title,l.appendChild(c)),c=document.createElement("div"),c.className="c_content",c.innerHTML=b[e].content.replace(/\n/g,
"<br>"),l.appendChild(c),c=document.createElement("div"),c.textContent="responder\u2026",c.className="reply_btn",c.id="replyto-"+b[e].id,c.addEventListener("click",function(a){a=this.id.split("-")[1];fillReplyTo(a)}),l.appendChild(c),m.appendChild(l),l=document.createElement("div"),l.id="replies-"+b[e].id,l.className="replies",m.appendChild(l),b[e].replyto?document.getElementById("replies-"+b[e].replyto).appendChild(m):g.appendChild(m);document.getElementById("c_replyto").value&&fillReplyTo(document.getElementById("c_replyto").value);
document.getElementById("c_link").addEventListener("click",function(){""==this.value&&(this.value="http://")});document.getElementById("c_link").addEventListener("blur",function(){"http://"==this.value&&(this.value="")});0!=d&&(h=d/f,document.getElementById("points").innerHTML=h.toFixed(1)+" ("+f+" valoraciones)");b=new google.visualization.DataTable;b.addColumn("date","Fecha");d=[];a=a._history;f=!1;for(var p in a){if(!f){for(var q in a[p])b.addColumn("number",q),d.push(FUEL_COLORS[q]);f=!0}g=p.split("-");
e=[];for(q in a[p])e.push(a[p][q]);b.addRows([[new Date(g[0],g[1]-1,g[2])].concat(e)])}b.sort(0);p={title:"Precios",theme:"maximized",pointSize:5,colors:d};(new google.visualization.LineChart(document.getElementById("chart"))).draw(b,p);initPoints();document.getElementById("error_list")&&document.getElementById("comments").scrollIntoView();document.getElementById("send_comment").addEventListener("click",function(){clearCurrentStorage()})}window.addEventListener("load",function(){getData(processData)});function searchLocation(a){var b="",d="",f="";"object"==typeof a?(b=a.geometry.location.lat(),d=a.geometry.location.lng(),f=encodeURI(a.formatted_address)):"string"==typeof a&&(d=a.split("##"),f=d[0],b=d[1],d=d[2]);a=document.getElementById("search-d").getAttribute("value");window.location="/resultados/"+f+"/"+b+"/"+d+"/"+a}
function showLoader(){document.getElementById("results-title").textContent="Buscando\u2026";var a=document.getElementById("results-list");a.innerHTML="";var b=new Image;b.src="/img/search-loader.gif";a.appendChild(b)}function initGeoloc(){var a=document.getElementById("current-loc");navigator.geolocation?a.addEventListener("click",loadCurrentPosition):a.style.display="none"}
function showResult(a,b){document.getElementById("results").style.display="block";var d=document.getElementById("results-list");d.innerHTML="";if(b==google.maps.GeocoderStatus.OK){for(var f=0,g=0,c=0;c<a.length;c++){var h=a[c].formatted_address;if(h.match(/Espa\u00f1a$/)){console.log(typeof a[c]);f++;var g=c,n=document.createElement("li"),e=document.createElement("a");n.appendChild(e);e.textContent=h;e.href="#";e.setAttribute("loc",[a[c].formatted_address,a[c].geometry.location.lat(),a[c].geometry.location.lng()].join("##"));
e.addEventListener("click",function(){searchLocation(this.getAttribute("loc"))});d.appendChild(n)}}if(1==f){searchLocation(a[g]);return}if(1<f){document.getElementById("results-title").textContent="Encontrados "+f+" lugares:";return}}d.innerHTML="<li>No se ha podido encontrar el lugar. Int\u00e9ntalo de nuevo</li>"}
function loadCurrentPosition(){showLoader();navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.Geocoder;a=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);b.geocode({latLng:a},showResult)},function(a){switch(a.code){case a.PERMISSION_DENIED:console.log("User denied the request for Geolocation.");break;case a.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case a.TIMEOUT:console.log("The request to get user location timed out.");break;
case a.UNKNOWN_ERROR:console.log("An unknown error occurred.")}})}function geoCode(){showLoader();var a=document.getElementById("address").value;(new google.maps.Geocoder).geocode({address:a,region:"es"},showResult)}
function mySlider(a){function b(a){var b=a.getElementsByClassName("val")[0],c=parseFloat(a.getAttribute("newval")),d=parseFloat(a.getAttribute("max")),n=parseFloat(a.getAttribute("min"));b.style.width=(c-n)*a.clientWidth/(d-n)-5+"px";b.textContent="Radio: "+c.toFixed(1)+" km.";a.setAttribute("value",c)}a.style.position="relative";var d=document.createElement("div");d.style.position="absolute";d.style.left="0";d.style.top="0";d.textContent="Radio: "+a.getAttribute("value")+" km.";d.className="val";
a.appendChild(d);d=document.createElement("div");d.style.position="absolute";d.style.left="0";d.style.top="0";d.className="new-val";d.style.display="none";a.appendChild(d);a.setAttribute("newval",a.getAttribute("value"));b(a);a.addEventListener("mousemove",function(a){var b=this.getElementsByClassName("new-val")[0];b.style.display="block";var c=a.clientX-this.getBoundingClientRect().left;b.style.width=c-5+"px";a=parseFloat(this.getAttribute("max"));var d=parseFloat(this.getAttribute("min")),n=parseFloat(this.getAttribute("step")),
c=d+c*(a-d)/this.clientWidth,c=parseInt(c/n)*n;c<d&&(c=d);c>a&&(c=a);b.textContent="Radio: "+c.toFixed(1)+" km.";this.setAttribute("newval",c)});a.addEventListener("click",function(a){this.getElementsByClassName("new-val")[0].style.display="none";b(this)});a.addEventListener("mouseout",function(a){this.getElementsByClassName("new-val")[0].style.display="none"})}
window.addEventListener("load",function(){for(var a=document.getElementsByClassName("my-slider"),b=0;b<a.length;b++)mySlider(a[b]);if(a=document.getElementById("map")){a=a.getElementsByClassName("prov");for(b=0;b<a.length;b++)a[b].addEventListener("click",function(){})}initGeoloc()});
