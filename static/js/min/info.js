var Lat2Km=111.03461,Km2Lat=0.009006,Lon2Km=85.39383,Km2Lon=0.01171,LL2Km=98.2,Km2LL=0.010183,FUEL_OPTIONS={1:{"short":"G95",name:"Gasolina 95"},3:{"short":"G98",name:"Gasolina 98"},4:{"short":"GOA",name:"Gas\u00f3leo Automoci\u00f3n"},5:{"short":"NGO",name:"Nuevo Gas\u00f3leo A"},6:{"short":"GOB",name:"Gas\u00f3leo B"},7:{"short":"GOC",name:"Gas\u00f3leo C"},8:{"short":"BIOD",name:"Biodi\u00e9sel"}},CHART_OPTIONS=[{id:"G98",color:"#339933",name:"Gasolina 98"},{id:"G95",color:"#006633",name:"Gasolina 95"},
{id:"NGO",color:"#aaa",name:"Nuevo Gas\u00f3leo A"},{id:"BIOD",color:"#f1aa41",name:"Biodi\u00e9sel"},{id:"GOA",color:"#000",name:"Gas\u00f3leo Automoci\u00f3n"},{id:"GOC",color:"#FF3300",name:"Gas\u00f3leo C"},{id:"GOB",color:"#CC3333",name:"Gas\u00f3leo B"}],PROVS={"\u00c1lava":"01",Albacete:"02",Alicante:"03","Almer\u00eda":"04",Asturias:"33","\u00c1vila":"05",Badajoz:"06","Balears (Illes)":"07",Barcelona:"08",Burgos:"09","C\u00e1ceres":"10","C\u00e1diz":"11",Cantabria:"39","Castell\u00f3n / Castell\u00f3":"12",
Ceuta:"51","Ciudad Real":"13","C\u00f3rdoba":"14","Coru\u00f1a (A)":"15",Cuenca:"16",Girona:"17",Granada:"18",Guadalajara:"19","Guip\u00fazcoa":"20",Huelva:"21",Huesca:"22","Ja\u00e9n":"23","Le\u00f3n":"24",Lleida:"25",Lugo:"27",Madrid:"28","M\u00e1laga":"29",Melilla:"52",Murcia:"30",Navarra:"31",Ourense:"32",Palencia:"34","Palmas (Las)":"35",Pontevedra:"36","Rioja (La)":"26",Salamanca:"37","Santa Cruz De Tenerife":"38",Segovia:"40",Sevilla:"41",Soria:"42",Tarragona:"43",Teruel:"44",Toledo:"45","Valencia / Val\u00e8ncia":"46",
Valladolid:"47",Vizcaya:"48",Zamora:"49",Zaragoza:"50"},MONTHS="Enero Febrero Marzo Abril Mayo Junio Julio Agosto Septiembre Octubre Noviembre Diciembre".split(" "),COLORS={stroke:"#fff",min:"#36AE34",max:"#f00",mu:"#3399CC"},LS_EXPIRE=36E5;function addEvent(a,f,b){a.addEventListener?a.addEventListener(f,b,!1):a.attachEvent&&a.attachEvent("on"+f,b)}
function getAllElementsByClassName(a,f){if(document.getElementsByClassName)return a.getElementsByClassName(f);f=f.replace(/ *$/,"");if(document.querySelectorAll)return a.querySelectorAll((" "+f).replace(/ +/g,"."))}function lockScroll(a){"string"==typeof a&&(a=document.getElementById(a));addEvent(a,"mouseover",function(){document.body.style.overflow="hidden"});addEvent(a,"mouseout",function(){document.body.style.overflow="auto"})}
function initProvLinks(a,f){var b=document.getElementById(a),e;for(e in PROVS){var d=document.createElement("li");d.id="plist-"+PROVS[e];if(f)d.textContent=e,d.onclick=f;else{var c=document.createElement("a");c.title="Todas las gasolineras de "+e;c.textContent=e;c.href="/gasolineras/"+encodeName(e);d.appendChild(c)}b.appendChild(d)}lockScroll(b)}function getProvName(a){for(k in PROVS)if(PROVS[k]==a)return k}function clearHtmlTags(a){return a.replace(/(<([^>]+)>)/ig,"")}
function toTitle(a){return a.replace(" [N]","").replace(/^CARRETERA ?|^CR\.? ?/i,"CTRA. ").replace(/(CTRA. )+/i,"CTRA. ").replace(/^AVENIDA ?|^AV. ?/i,"AVDA. ").replace(/^POLIGONO INDUSTRIAL ?|POLIGONO ?|P\.I\. ?/i,"POL. IND. ").replace(/^CALLE |^CL\.? ?|C\/ ?/i,"C/ ").replace(/^RONDA |^RD /i,"RDA. ").replace(/^AUTOPISTA (AUTOPISTA ?)?/i,"AU. ").replace(/^PLAZA ?/i,"PL. ").replace(/^PASEO (PASEO ?)?/i,"P\u00ba ").replace(/^TRAVESS?[I\u00cd]A /i,"TRAV. ").replace(/^V[i\u00ed]A (V[I\u00cd]A )?/i,"V\u00cdA ").replace(/\B[^\d- ]+[ $]/g,
function(a){return a.toLowerCase()}).replace(/\b[NAE]-.+\b/,function(a){return a.toUpperCase()}).replace(/\[D\]$/,"(m.d.)").replace(/\[I\]$/,"(m.i.)").replace(/ \[N\]$/,"")}
function getLogo(a){return a&&(a=a.replace(/camspa/i,"campsa"),a=a.match(/\b(abycer|agla|alcampo|andamur|a\.?n\.? energeticos|avia|bonarea|b\.?p\.?|buquerin|campsa|carmoned|carrefour|cepsa|empresoil|eroski|esclatoil|galp|gasolben|iberdoex|leclerc|makro|meroil|norpetrol|petrem|petrocat|petromiralles|petronor|ramell|repostar|repsol|saras|shell|simply|staroil|tamoil|valcarce)\b/i))?a[0].replace(/\./g,"").replace(/ /g,"_").toLowerCase():null}
function decodeName(a){return decodeURI(a).replace(/_/g," ").replace(/\|/g,"/")}function decodeArray(a){for(var f=0;f<a.length;f++)a[f]=decodeName(a[f]);return a}function encodeName(a){return encodeURI(a.replace(/\//g,"|").replace(/ /g,"_"))}function prettyName(a){a.match("/")&&(a=a.split("/")[1]);a.match(/\)$/)&&(a=a.match(/\(.+\)$/g)[0].replace("(","").replace(")"," ")+a.split(" (")[0]);return a}
function checkLocalStorage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}function getKey(){return window.location.pathname.split("/").slice(1).join("*")}
function getApiData(a,f,b){"undefined"==typeof b&&(b=!1);var e=a+"*"+getKey(),d=(new Date).getTime();if(checkLocalStorage()){var c=localStorage[e];if(c)if(c=JSON.parse(c),d-c.ts>LS_EXPIRE||b)localStorage.removeItem(e);else{f(c.data);return}}b=new XMLHttpRequest;b.onreadystatechange=function(a){4==this.readyState&&200==this.status&&(a=JSON.parse(this.responseText),checkLocalStorage()&&localStorage.setItem(e,JSON.stringify({ts:d,data:a})),f(a))};c="api/";"history"==a?c+="h":"comments"==a&&(c+="c");
a=window.location.pathname.split("/")[1];b.open("GET",document.URL.replace(a,c));b.send()}function distance(a,f,b){var e=Math.abs(a[0]-f[0])*Lat2Km;return e<b&&(a=Math.abs(a[1]-f[1])*Lon2Km,a<b&&(e=Math.sqrt(e*e+a*a),e<b))?e:!1}
function distanceOrto(a,f,b,e){var d=[b[0]-f[0],b[1]-f[1]],c=[a[0]-f[0],a[1]-f[1]],c=(c[0]*d[0]+c[1]+d[1])/(d[0]*d[0]+d[1]*d[1]);if(0>=c)return distance(a,f,e);if(1<=c)return distance(a,b,e);a=[(f[0]+c*d[0]-a[0])*Lat2Km,(f[1]+c*d[1]-a[1])*Lon2Km];return Math.sqrt(a[0]*a[0]+a[1]*a[1])<e}
function SearchLocations(){this.locs=[];this.radius=2;this.length=function(){return this.locs.length};this.add=function(a,f){this.locs.push({name:a,latlng:f})};this.latlng=function(){return 1==this.length()?this.locs[0].latlng:null};this.name=function(){return 1==this.length()?this.locs[0].name:null};this.get=function(a){return this.locs[a]};this.select=function(a){this.locs=[this.locs[a]]};this.clear=function(){this.locs=[]}}
function Stats(){this.n=0;this.max=this.min=this.mu=this.range=null;this.smin=[];this.smax=[];this.g=null;this.range=function(){null==this.range&&(this.range=this.max-this.min);return this.range};this.add=function(a,f,b){this.mu?(a>this.max?(this.max=a,this.smax=[f]):a==this.max?this.smax.push(f):a<this.min?(this.min=a,this.smin=[f]):a==this.min&&this.smin.push(f),this.mu=(this.mu*this.n+a)/++this.n):(this.max=this.min=this.mu=a,this.smin=[f],this.smax=[f],this.n=1);b&&(this.g?(b[0]<this.g[0]?this.g[0]=
b[0]:b[0]>this.g[1]&&(this.g[1]=b[0]),b[1]<this.g[2]?this.g[2]=b[1]:b[1]>this.g[3]&&(this.g[3]=b[1])):this.g=[b[0],b[0],b[1],b[1]])}}
function GasoleStats(a,f){function b(a,f,b,e){f[e]||(f[e]=new Stats);b[e]||(b[e]=new Stats);f[e].add(a.o[e],[d,h,p],a.g);b[e].add(a.o[e],[d,h,p],a.g)}var e=this.stats={};this.provinces={};for(var d in a){var c=a[d],g=this.provinces[d]={},h;for(h in c){var l=c[h],p;for(p in l)if(datas=l[p],f)for(var m=f.length-1;0<=m;m--){var n=f[m];datas.o[n]&&b(datas,g,e,n)}else for(n in datas.o)b(datas,g,e,n)}}}
function Gasole(a){this.color=function(a){var b=this.stats.range();if(0!=b){a=(a-this.stats.min)/b;if(0.33>a)return COLORS.min;if(0.66<a)return COLORS.max}return COLORS.mu};this.init=function(a,b,e){this.info=a;this.date=b;this.stats=e?e:new GasoleStats(this.info)};this.provinceDataArray=function(a){this.stats=new Stats;var b=this.type;result=[];a=this.info[a];for(var e in a){var d=a[e],c;for(c in d){var g=d[c],h=g.o[b];h&&(result.push({a:c,r:g.r,g:g.g,p:h,t:e,l:g.l,d:null}),this.stats.add(h))}}return result};
this.nearData=function(a){var b=a.latlng();if(b){a=a.radius;var e={},d;for(d in this.info){var c=this.info[d];e[d]={};for(var g in c){var h=c[g];e[d][g]={};for(var l in h){var p=h[l],m=p.g;m&&distance(m,b,a)&&(e[d][g][l]=p)}Object.keys(e[d][g]).length||delete e[d][g]}Object.keys(e[d]).length||delete e[d]}return e}};this.nearDataArray=function(a,b,e){var d=a.latlng();if(d){a=a.radius;this.stats=new Stats;var c=[],g;for(g in this.info){var h=this.info[g],l;for(l in h){var p=h[l],m;for(m in p){var n=
p[m];if(n.o.hasOwnProperty(b)){var q=n.g;if(q){var r=distance(q,d,a);if(r){var s=n.o[b];c.push({a:m,prov:g,g:q,p:s,t:l,l:n.l,d:r});this.stats.add(s)}}}}}}return e?c.sort(function(a,b){return a[e]<b[e]?-1:1}):c}};this.routeData=function(a){var b={};gasoleProcess(this.info,function(e,d,c,g){var h=e.g;if(h)for(var l=0,p=a.length-1;l<p;l++){var m=a[l],n=a[l+1];distanceOrto(h,[m.lat(),m.lng()],[n.lat(),n.lng()],1)&&((m=b[d])||(m=b[d]={}),(n=m[c])||(n=m[c]={}),n[g]=e)}});return b};this.callback=a;this.date=
this.info=this.stats=null;this.type="1";a=null;checkLocalStorage()&&(a=localStorage.gasole)&&(a=JSON.parse(a));!a||(new Date).getTime()-parseInt(a.ts)>LS_EXPIRE?(a=new XMLHttpRequest,a.gasole=this,a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var a=null,b=JSON.parse(this.responseText);b._meta?(a=new Date(b._meta.ts),b=b._data):a=new Date;this.gasole.init(b,a);checkLocalStorage()&&(a={ts:a.getTime(),data:b,stats:this.gasole.stats},localStorage.setItem("gasole",JSON.stringify(a)));
this.gasole.callback&&this.gasole.callback()}},a.open("GET","/api/gasole"),a.send()):(this.init(a.data,new Date(a.ts),a.stats),this.callback&&this.callback())}function fillPriceDigits(a,f){a.innerHTML="";for(var b=f.toFixed(3),e=0;e<b.length;e++){var d=document.createElement("div");d.className="back";"."==b[e]?d.className+=" point":d.textContent=8;var c=document.createElement("div");c.className="digit";c.textContent=b[e];d.appendChild(c);a.appendChild(d)}}
function gasoleProcess(a,f){for(var b in a){var e=a[b],d;for(d in e){var c=e[d],g;for(g in c)f(c[g],b,d,g)}}}function stopEvent(a){a.cancelBubble=!0;a.returnValue=!1;a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();return!1}
function sortName(a,f){function b(a){a=a.toLowerCase();a=a.replace(RegExp(/\s/g),"");a=a.replace(RegExp(/[\u00e0\u00e1]/g),"a");a=a.replace(RegExp(/[\u00e8\u00e9]/g),"e");a=a.replace(RegExp(/[\u00ec\u00ed]/g),"i");a=a.replace(RegExp(/[\u00f2\u00f3]/g),"o");return a=a.replace(RegExp(/[\u00f9\u00fa]/g),"u")}return b(a)<b(f)?-1:1}
function formatUpdate(a){var f;f="Precios actualizados el "+(a.getDate()+" de "+MONTHS[a.getMonth()]);return f+=" a las "+("0"+a.getHours()).slice(-2)+":"+("0"+a.getMinutes()).slice(-2)}Array.prototype.filter||(Array.prototype.filter=function(a,f){if(null==this)throw new TypeError;var b=Object(this),e=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],c=0;c<e;c++)if(c in b){var g=b[c];a.call(f,g,c,b)&&d.push(g)}return d});var TIME;function tic(){TIME=(new Date).getTime()}
function toc(a){console.log((a?a+" :":"Transcurridos: ")+((new Date).getTime()-TIME)+" ms")}
function breadCrumb(a,f){var b=document.getElementById(a);if(b){b.innerHTML="<a href='/' class='bc'>Gasolineras</a><span class='sprt breadcrumb'>&nbsp;</span>";var e=window.location.pathname.split("/"),d=document.createElement("a");d.className="bc";if("resultados"==e[1])d.textContent="Cerca de "+decodeURI(e[2]),d.href="#",b.appendChild(d);else if("ruta"==e[1])d.textContent="Ruta entre "+decodeURI(e[2])+" y"+decodeURI(e[3]),d.href="#",d.title=d.textContent,b.appendChild(d);else{var c=decodeName(e[2]);
d.textContent=c;d.title="Ver todas las gasolineras en la provincia de "+c;var g="/gasolineras/"+e[2];d.href=g;b.appendChild(d);e[3]&&(b.innerHTML+="<span class='sprt breadcrumb'>&nbsp;</span>",d=document.createElement("a"),d.className="bc",c=decodeName(e[3]),d.textContent=c,d.title="Ver todas las gasolineras en la localidad de "+c,d.href=g+"/"+e[3],b.appendChild(d));e[4]&&(b.innerHTML+="<span class='sprt breadcrumb'>&nbsp;</span>",d=document.createElement("a"),d.className="bc",d.textContent="Gasolinera "+
(f?f:"")+" en "+toTitle(decodeName(e[4])),d.href=window.location.pathname,b.appendChild(d))}}};(function(a){function f(a){!window.google||!window.google.maps?(window._geoCallback=a,a=document.createElement("script"),a.type="text/javascript",a.src="http://maps.googleapis.com/maps/api/js?key=AIzaSyD5XZNFlQsyWtYDeKual-OcqmP_5pgwbds&sensor=false&callback=_geoCallback",document.body.appendChild(a)):a()}function b(a,b,d,e){var c=this;c.href=null;var n=c.loader=document.createElement("div"),q=c.input=document.createElement("input"),r=c.list=document.createElement("ol");c.enable=function(a){a?c.input.removeAttribute("disabled"):
c.input.setAttribute("disabled","")};c.getPlace=function(){return c.href};c.geoCode=function(){var a=c.input.value;a&&(c.showLoader(!0),(new google.maps.Geocoder).geocode({address:a,region:"es"},function(a,b){c.showList(a,b)}))};c.showLoader=function(a){n.style.display=a?"block":"none"};c.init=function(a){c.href=a;c.input.value=decodeURIComponent(a.split("/")[0])};c.clearList=function(){r.innerHTML=""};c.showList=function(a,b){c.showLoader(!1);c.clearList();if(b==google.maps.GeocoderStatus.OK){for(var d=
function(a){c.href=a.getAttribute("data-place");q.value=a.textContent;c.clearList()},e=0,f,h,l=0;l<a.length;l++){var g=a[l].geometry.location;f=a[l].formatted_address;f.match(/Espa\u00f1a$/)&&(e++,h=document.createElement("li"),h.setAttribute("data-place",encodeURIComponent(f)+"/"+g.lat()+"/"+g.lng()),h.textContent=f,h.onclick=function(){d(this)},r.appendChild(h))}1==e&&d(h);if(0<e)return}r.innerHTML="<li>No se ha podido encontrar el lugar. Int\u00e9ntalo de nuevo.</li>"};a=document.getElementById(a);
d&&void 0!=navigator.geolocation&&(c.loadCurrentPosition=function(){navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.Geocoder;a=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);b.geocode({latLng:a},c.showList)},function(a){switch(a.code){case a.PERMISSION_DENIED:console.log("No has permitido que obtengamos tu posici\u00f3n.");break;case a.POSITION_UNAVAILABLE:console.log("No es posible obtener tu posici\u00f3n acual.");break;case a.TIMEOUT:console.log("Se ha agotado el tiempo de espera.");
break;case a.UNKNOWN_ERROR:console.log("Ha ocurrido un error desconocido.")}})},d=document.createElement("div"),d.className="sprt search_gps",d.onclick=function(){c.showLoader(!0);f(c.loadCurrentPosition)},a.appendChild(d));n.className="loader";a.appendChild(n);q.setAttribute("type","search");q.setAttribute("placeholder",b);a.appendChild(q);r.className="results";lockScroll(r);a.appendChild(r);a.onsubmit=function(){f(c.geoCode);return!1};q.onblur=function(){null==c.href&&f(c.geoCode)};q.onsearch=function(){c.clearList();
c.href=null;console.log("tetas")};c.enable(e)}function e(a){this.value=2;this.max=20;this.min=1;this.step=0.2;this.candidate=this.value;var b=this;sliderDiv=document.getElementById(a);barDiv=document.createElement("div");padDiv=document.createElement("div");sliderDiv.style.position="relative";barDiv.style.position="absolute";barDiv.style.left="0";barDiv.style.top="0";barDiv.className="bar";sliderDiv.appendChild(barDiv);padDiv.style.position="absolute";padDiv.style.top=padDiv.style.left=padDiv.style.right=
padDiv.style.bottom=0;sliderDiv.appendChild(padDiv);this.getvalue=function(){return Math.round(this.value/this.step)*this.step};this.updateSlider=function(a){barDiv.style.width=Math.round((a-b.min)*sliderDiv.clientWidth/(b.max-b.min))+"px";barDiv.textContent="Radio: "+a.toFixed(1)+" km."};this.updateSlider(this.value);addEvent(padDiv,"mousemove",function(a){a=a.clientX-2-this.getBoundingClientRect().left;a=b.min+a*(b.max-b.min)/this.clientWidth;a=Math.round(a/b.step)*b.step;a=Math.max(b.min,a);a=
Math.min(b.max,a);b.candidate=a;b.updateSlider(b.candidate)});addEvent(padDiv,"click",function(a){b.value=b.candidate;b.updateSlider(b.value)});addEvent(padDiv,"mouseout",function(a){b.updateSlider(b.value)});this.enable=function(a){sliderDiv.style.display=a?"block":"none"}}var d=null,c=null;addEvent(a,"load",function(){function a(){var b=d.getPlace();b&&(window.location="/resultados/"+b+"/"+sliderDist.getvalue().toFixed(1))}function f(){var a=d.getPlace(),b=c.getPlace();null!=a&&null!=b&&(window.location=
"/ruta/"+a.split("/")[0]+"/"+b.split("/")[0])}sliderDist=new e("search-d");d=new b("search-form","Gran V\u00eda 35, Madrid -o- Aeropuerto -o- Hotel Palace",!0,!0);c=new b("search-form-dest","Barcelona",!1,!1);var l=document.getElementById("menu-search"),p=document.getElementById("search-b");addEvent(l,"click",function(a){stopEvent(a);this.className="menu search enabled";addEvent(document,"click",function(){l.className="menu search"})});addEvent(document.getElementById("route"),"click",function(){var b=
null==this.className.match(" on");sliderDist.enable(!b);c.enable(b);this.className="sprt directions"+(b?" on":"");p.onclick=b?f:a});var m=window.location.pathname.split("/");"resultados"==m[1]&&(d.init(m.slice(2,5).join("/")),sliderDist.updateSlider(parseFloat(m[5])));p.onclick=a})})(window);
