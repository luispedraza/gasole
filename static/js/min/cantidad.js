var data,map;function initialize(){var a={zoom:8,center:new google.maps.LatLng(40.4,-3.6833),mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map"),a)}
function drawData(a){console.log("procesando)");var b=[],c=lonSum=0;for(p in a)for(t in a[p])for(s in a[p][t])if(a[p][t][s].latlon){var d=new google.maps.LatLng(a[p][t][s].latlon[0],a[p][t][s].latlon[1]),c=c+d.lat();lonSum+=d.lng();b.push(d)}map.panTo(new google.maps.LatLng(c/b.length,lonSum/b.length));new google.maps.visualization.HeatmapLayer({data:b,dissipating:!0,radius:15,gradient:["transparent","#00f","#0f0","#f00"],map:map})}
window.addEventListener("load",function(){initialize();var a=new XMLHttpRequest;a.onload=function(a){(data=JSON.parse(a.target.responseText))&&console.log(data)};a.open("GET",document.URL.replace("graficos/cantidad","stats"),!0);a.send()});function searchLocation(a){var b="",c="",d="";"object"==typeof a?(b=a.geometry.location.lat(),c=a.geometry.location.lng(),d=encodeURI(a.formatted_address)):"string"==typeof a&&(c=a.split("##"),d=c[0],b=c[1],c=c[2]);a=document.getElementById("search-d").getAttribute("value");window.location="/resultados/"+d+"/"+b+"/"+c+"/"+a}
function showLoader(){document.getElementById("results-title").textContent="Buscando\u2026";var a=document.getElementById("results-list");a.innerHTML="";var b=new Image;b.src="/img/search-loader.gif";a.appendChild(b)}function initGeoloc(){var a=document.getElementById("current-loc");navigator.geolocation?a.addEventListener("click",loadCurrentPosition):a.style.display="none"}
function showResult(a,b){document.getElementById("results").style.display="block";var c=document.getElementById("results-list");c.innerHTML="";if(b==google.maps.GeocoderStatus.OK){for(var d=0,k=0,f=0;f<a.length;f++){var e=a[f].formatted_address;if(e.match(/Espa\u00f1a$/)){console.log(typeof a[f]);d++;var k=f,g=document.createElement("li"),h=document.createElement("a");g.appendChild(h);h.textContent=e;h.href="#";h.setAttribute("loc",[a[f].formatted_address,a[f].geometry.location.lat(),a[f].geometry.location.lng()].join("##"));
h.addEventListener("click",function(){searchLocation(this.getAttribute("loc"))});c.appendChild(g)}}if(1==d){searchLocation(a[k]);return}if(1<d){document.getElementById("results-title").textContent="Encontrados "+d+" lugares:";return}}c.innerHTML="<li>No se ha podido encontrar el lugar. Int\u00e9ntalo de nuevo</li>"}
function loadCurrentPosition(){showLoader();navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.Geocoder;a=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);b.geocode({latLng:a},showResult)},function(a){switch(a.code){case a.PERMISSION_DENIED:console.log("User denied the request for Geolocation.");break;case a.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case a.TIMEOUT:console.log("The request to get user location timed out.");break;
case a.UNKNOWN_ERROR:console.log("An unknown error occurred.")}})}function geoCode(){showLoader();var a=document.getElementById("address").value;(new google.maps.Geocoder).geocode({address:a,region:"es"},showResult)}
function mySlider(a){function b(a){var c=a.getElementsByClassName("val")[0],b=parseFloat(a.getAttribute("newval")),e=parseFloat(a.getAttribute("max")),g=parseFloat(a.getAttribute("min"));c.style.width=(b-g)*a.clientWidth/(e-g)-5+"px";c.textContent="Radio: "+b.toFixed(1)+" km.";a.setAttribute("value",b)}a.style.position="relative";var c=document.createElement("div");c.style.position="absolute";c.style.left="0";c.style.top="0";c.textContent="Radio: "+a.getAttribute("value")+" km.";c.className="val";
a.appendChild(c);c=document.createElement("div");c.style.position="absolute";c.style.left="0";c.style.top="0";c.className="new-val";c.style.display="none";a.appendChild(c);a.setAttribute("newval",a.getAttribute("value"));b(a);a.addEventListener("mousemove",function(a){var c=this.getElementsByClassName("new-val")[0];c.style.display="block";var b=a.clientX-this.getBoundingClientRect().left;c.style.width=b-5+"px";a=parseFloat(this.getAttribute("max"));var e=parseFloat(this.getAttribute("min")),g=parseFloat(this.getAttribute("step")),
b=e+b*(a-e)/this.clientWidth,b=parseInt(b/g)*g;b<e&&(b=e);b>a&&(b=a);c.textContent="Radio: "+b.toFixed(1)+" km.";this.setAttribute("newval",b)});a.addEventListener("click",function(a){this.getElementsByClassName("new-val")[0].style.display="none";b(this)});a.addEventListener("mouseout",function(a){this.getElementsByClassName("new-val")[0].style.display="none"})}
window.addEventListener("load",function(){for(var a=document.getElementsByClassName("my-slider"),b=0;b<a.length;b++)mySlider(a[b]);if(a=document.getElementById("map")){a=a.getElementsByClassName("prov");for(b=0;b<a.length;b++)a[b].addEventListener("click",function(){})}initGeoloc()});
